"use strict";function submitForm(e,o){var t=""!=o;console.log("update? "+t);var i={first:e.first,last:e.last,email:e.email},n="";t?(n=apiString+"/booking/"+o,$.ajax({url:n,type:"PUT",data:i,success:handleEditSuccess})):(n=apiString+"/create",$.post(n,i,handleEditSuccess)),console.log("querying: %s",n)}function handleEditSuccess(e,o,t){console.log(e,o,t.statusText,t.status),201==t.status?($(".success-page > .section-header > h3").text("Thank you!"),$("#booked-id").text("Your booking ID: "+e.data.book_id),$("#booked-name").text("Registered name: "+e.data.first+" "+e.data.last),$("#booked-email").text("Email address: "+e.data.email),$(".success-page > .section-wrapper > p").show(),""!=$("#found-id").val()?($(".success-page > .section-header > p").text("Your accomodations have been updated successfully. Check out the details below:"),$("#found-id").val("")):$(".success-page > .section-header > p").text("Your accomodations have been booked successfully. Check out the details below:"),$(".booking-form").hide(),$(".success-page").show()):0==$("#errormsg").length&&$(".booking-form .section-wrapper").append('<p id="errormsg">Looks like there was an error, %s %s! Try again.</p>',t.status,t.statusText)}function cancelBooking(e){var o=apiString+"/booking/"+e;$.ajax({url:o,type:"DELETE",success:handleDeleteSuccess})}function handleDeleteSuccess(){var e=$("#found-id").val();$(".success-page > .section-header > h3").text("Cancelled reservation"),$(".success-page > .section-wrapper > p").hide(),$(".success-page > .section-header > p").text("Your booking (#"+e+") has been cancelled. We're sorry to see you go!"),$(".booking-form").hide(),$(".success-page").show()}function findByRef(e){var o=apiString+"/booking/"+e;$.getJSON(o,function(e){e.data?($("#firstname").val(e.data.first),$("#lastname").val(e.data.last),$("#email").val(e.data.email),$("#found-id").val(e.data.book_id),$(".booking-form > .section-header > h3").text("Update your booking"),$(".booking-form > .section-header > p").text("We found your booking record, "+e.data.first+". Feel free to change any of the fields below if you need to update it."),$("#submit-btn").text("Update booking"),$(".booking-form > .section-footer > p").html('Want to start over? <a href="#" class="search-link">Go back</a>'),$(".cancel-link").click(function(){cancelBooking(e.data.book_id)}),$(".cancel-prompt").show(),$(".booking-form").show(),$(".search-form").hide(),$(".search-link").click(function(){$(".booking-form").hide(),$(".search-form").show()}),$("#search-input").val("")):console.log("not found!")})}function showSpinner(){$(".ajax-spinner").show()}function hideSpinner(){$(".ajax-spinner").hide()}var apiString="https://com601-assign1.herokuapp.com/api";$(document).ready(function(){$(".booking-form").hide(),$(".cancel-prompt").hide(),$(".success-page").hide(),$(".ajax-spinner").hide(),$(".search-link").click(function(){$(".booking-form").hide(),$(".search-form").show()}),$(".booking-link").click(function(){$("#firstname").val(""),$("#lastname").val(""),$("#email").val(""),$("#search-input").val(""),$("#found-id").val(""),$(".cancel-prompt").hide(),$("#submit-btn").text("Reserve now"),$(".booking-form > .section-header > h3").text("Create a new booking"),$(".booking-form > .section-header > p").text("Fill out the fields below to book a new accomodation"),$(".booking-form > .section-footer > p").html('Already have accomodations? <a href="#" class="search-link">Look up your booking here!</a>'),$(".search-link").click(function(){$(".booking-form").hide(),$(".search-form").show()}),$(".booking-form").show(),$(".search-form").hide(),$(".success-page").hide()});var e=$("#submit-btn");e.click(function(){var e=$("#firstname").val(),o=$("#lastname").val(),t=$("#email").val(),i={first:e,last:o,email:t};if(e&&o&&t){var n=$("#found-id").val();console.log("booking: ",i,n),submitForm(i,n)}else console.log("form values missing!")});var o=$("#search-btn");o.click(function(){var e=$("#search-input").val();e?(showSpinner(),findByRef(e),hideSpinner()):console.log("search ID missing!",e)}),$("#search-input").keypress(function(e){13==e.keyCode&&o.click()}),$(".booking-form > .section-wrapper > input").keypress(function(o){13==o.keyCode&&e.click()});var t={lines:9,length:34,width:6,radius:24,scale:1,corners:.2,color:"#000",opacity:.25,rotate:0,direction:1,speed:.8,trail:25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!0,position:"absolute"},i=$(".ajax-spinner");new Spinner(t).spin(i)});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,o){"object"==("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=o():"function"==typeof define&&define.amd?define(o):e.Spinner=o()}(void 0,function(){function e(e,o){var t,i=document.createElement(e||"div");for(t in o)i[t]=o[t];return i}function o(e){for(var o=1,t=arguments.length;o<t;o++)e.appendChild(arguments[o]);return e}function t(e,o,t,i){var n=["opacity",o,~~(100*e),t,i].join("-"),a=.01+t/i*100,s=Math.max(1-(1-e)/o*(100-a),e),r=c.substring(0,c.indexOf("Animation")).toLowerCase(),d=r&&"-"+r+"-"||"";return u[n]||(l.insertRule("@"+d+"keyframes "+n+"{0%{opacity:"+s+"}"+a+"%{opacity:"+e+"}"+(a+.01)+"%{opacity:1}"+(a+o)%100+"%{opacity:"+e+"}100%{opacity:"+s+"}}",l.cssRules.length),u[n]=1),n}function i(e,o){var t,i,n=e.style;if(o=o.charAt(0).toUpperCase()+o.slice(1),void 0!==n[o])return o;for(i=0;i<d.length;i++)if(t=d[i]+o,void 0!==n[t])return t}function n(e,o){for(var t in o)e.style[i(e,t)||t]=o[t];return e}function a(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var i in t)void 0===e[i]&&(e[i]=t[i])}return e}function s(e,o){return"string"==typeof e?e:e[o%e.length]}function r(e){this.opts=a(e||{},r.defaults,p)}var c,l,d=["webkit","Moz","ms","O"],u={},p={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(r.defaults={},a(r.prototype,{spin:function(o){this.stop();var t=this,i=t.opts,a=t.el=e(null,{className:i.className});if(n(a,{position:i.position,width:0,zIndex:i.zIndex,left:i.left,top:i.top}),o&&o.insertBefore(a,o.firstChild||null),a.setAttribute("role","progressbar"),t.lines(a,t.opts),!c){var s,r=0,l=(i.lines-1)*(1-i.direction)/2,d=i.fps,u=d/i.speed,p=(1-i.opacity)/(u*i.trail/100),f=u/i.lines;!function e(){r++;for(var o=0;o<i.lines;o++)s=Math.max(1-(r+(i.lines-o)*f)%u*p,i.opacity),t.opacity(a,o*i.direction+l,s,i);t.timeout=t.el&&setTimeout(e,~~(1e3/d))}()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(i,a){function r(o,t){return n(e(),{position:"absolute",width:a.scale*(a.length+a.width)+"px",height:a.scale*a.width+"px",background:o,boxShadow:t,transformOrigin:"left",transform:"rotate("+~~(360/a.lines*d+a.rotate)+"deg) translate("+a.scale*a.radius+"px,0)",borderRadius:(a.corners*a.scale*a.width>>1)+"px"})}for(var l,d=0,u=(a.lines-1)*(1-a.direction)/2;d<a.lines;d++)l=n(e(),{position:"absolute",top:1+~(a.scale*a.width/2)+"px",transform:a.hwaccel?"translate3d(0,0,0)":"",opacity:a.opacity,animation:c&&t(a.opacity,a.trail,u+d*a.direction,a.lines)+" "+1/a.speed+"s linear infinite"}),a.shadow&&o(l,n(r("#000","0 0 4px #000"),{top:"2px"})),o(i,o(l,r(s(a.color,d),"0 0 1px rgba(0,0,0,.1)")));return i},opacity:function(e,o,t){o<e.childNodes.length&&(e.childNodes[o].style.opacity=t)}}),"undefined"!=typeof document){l=function(){var t=e("style",{type:"text/css"});return o(document.getElementsByTagName("head")[0],t),t.sheet||t.styleSheet}();var f=n(e("group"),{behavior:"url(#default#VML)"});!i(f,"transform")&&f.adj?function(){function t(o,t){return e("<"+o+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}l.addRule(".spin-vml","behavior:url(#default#VML)"),r.prototype.lines=function(e,i){function a(){return n(t("group",{coordsize:d+" "+d,coordorigin:-l+" "+-l}),{width:d,height:d})}function r(e,r,c){o(p,o(n(a(),{rotation:360/i.lines*e+"deg",left:~~r}),o(n(t("roundrect",{arcsize:i.corners}),{width:l,height:i.scale*i.width,left:i.scale*i.radius,top:-i.scale*i.width>>1,filter:c}),t("fill",{color:s(i.color,e),opacity:i.opacity}),t("stroke",{opacity:0}))))}var c,l=i.scale*(i.length+i.width),d=2*i.scale*l,u=-(i.width+i.length)*i.scale*2+"px",p=n(a(),{position:"absolute",top:u,left:u});if(i.shadow)for(c=1;c<=i.lines;c++)r(c,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(c=1;c<=i.lines;c++)r(c);return o(e,p)},r.prototype.opacity=function(e,o,t,i){var n=e.firstChild;i=i.shadow&&i.lines||0,n&&o+i<n.childNodes.length&&(n=(n=(n=n.childNodes[o+i])&&n.firstChild)&&n.firstChild)&&(n.opacity=t)}}():c=i(f,"animation")}return r});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZvcm0uanMiLCJzcGluLmpzIl0sIm5hbWVzIjpbInN1Ym1pdEZvcm0iLCJib29raW5nIiwib2xkSWQiLCJ1cGRhdGVGbGFnIiwiY29uc29sZSIsImxvZyIsInBvc3REYXRhIiwiZmlyc3QiLCJsYXN0IiwiZW1haWwiLCJxdWVyeSIsImFwaVN0cmluZyIsIiQiLCJhamF4IiwidXJsIiwidHlwZSIsImRhdGEiLCJzdWNjZXNzIiwiaGFuZGxlRWRpdFN1Y2Nlc3MiLCJwb3N0IiwicmVzdWx0Iiwic3RhdHVzIiwicmVzcCIsInN0YXR1c1RleHQiLCJ0ZXh0IiwiYm9va19pZCIsInNob3ciLCJ2YWwiLCJoaWRlIiwibGVuZ3RoIiwiYXBwZW5kIiwiY2FuY2VsQm9va2luZyIsImlkIiwiaGFuZGxlRGVsZXRlU3VjY2VzcyIsImZpbmRCeVJlZiIsImdldEpTT04iLCJodG1sIiwiY2xpY2siLCJzaG93U3Bpbm5lciIsImhpZGVTcGlubmVyIiwiZG9jdW1lbnQiLCJyZWFkeSIsInN1Ym1pdEJ0biIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwibmV3Qm9va2luZyIsInNlYXJjaEJ0biIsInNlYXJjaElkIiwia2V5cHJlc3MiLCJlIiwia2V5Q29kZSIsIm9wdHMiLCJsaW5lcyIsIndpZHRoIiwicmFkaXVzIiwic2NhbGUiLCJjb3JuZXJzIiwiY29sb3IiLCJvcGFjaXR5Iiwicm90YXRlIiwiZGlyZWN0aW9uIiwic3BlZWQiLCJ0cmFpbCIsImZwcyIsInpJbmRleCIsImNsYXNzTmFtZSIsInRvcCIsImxlZnQiLCJzaGFkb3ciLCJod2FjY2VsIiwicG9zaXRpb24iLCJ0YXJnZXQiLCJTcGlubmVyIiwic3BpbiIsIl90eXBlb2YiLCJTeW1ib2wiLCJpdGVyYXRvciIsIm9iaiIsImNvbnN0cnVjdG9yIiwicHJvdG90eXBlIiwicm9vdCIsImZhY3RvcnkiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVmaW5lIiwiYW1kIiwidW5kZWZpbmVkIiwiY3JlYXRlRWwiLCJ0YWciLCJwcm9wIiwibiIsImVsIiwiY3JlYXRlRWxlbWVudCIsImlucyIsInBhcmVudCIsImkiLCJhcmd1bWVudHMiLCJhcHBlbmRDaGlsZCIsImFkZEFuaW1hdGlvbiIsImFscGhhIiwibmFtZSIsImpvaW4iLCJzdGFydCIsInoiLCJNYXRoIiwibWF4IiwicHJlZml4IiwidXNlQ3NzQW5pbWF0aW9ucyIsInN1YnN0cmluZyIsImluZGV4T2YiLCJ0b0xvd2VyQ2FzZSIsInByZSIsImFuaW1hdGlvbnMiLCJzaGVldCIsImluc2VydFJ1bGUiLCJjc3NSdWxlcyIsInZlbmRvciIsInBwIiwicyIsInN0eWxlIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsInByZWZpeGVzIiwiY3NzIiwibWVyZ2UiLCJkZWYiLCJnZXRDb2xvciIsImlkeCIsIm8iLCJ0aGlzIiwiZGVmYXVsdHMiLCJzdG9wIiwic2VsZiIsImluc2VydEJlZm9yZSIsImZpcnN0Q2hpbGQiLCJzZXRBdHRyaWJ1dGUiLCJmIiwib3N0ZXAiLCJhc3RlcCIsImFuaW0iLCJqIiwidGltZW91dCIsInNldFRpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJmaWxsIiwiaGVpZ2h0IiwiYmFja2dyb3VuZCIsImJveFNoYWRvdyIsInRyYW5zZm9ybU9yaWdpbiIsInRyYW5zZm9ybSIsImJvcmRlclJhZGl1cyIsInNlZyIsImFuaW1hdGlvbiIsImNoaWxkTm9kZXMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInN0eWxlU2hlZXQiLCJwcm9iZSIsImJlaGF2aW9yIiwiYWRqIiwidm1sIiwiYXR0ciIsImFkZFJ1bGUiLCJncnAiLCJjb29yZHNpemUiLCJjb29yZG9yaWdpbiIsInIiLCJkeCIsImZpbHRlciIsImciLCJyb3RhdGlvbiIsImFyY3NpemUiLCJtYXJnaW4iLCJjIiwiaW5pdFZNTCJdLCJtYXBwaW5ncyI6IkFBQUEsYUFvQ0EsU0FBQUEsV0FBQUMsRUFBQUMsR0FFQSxJQUFBQyxFQUFBLElBQUFELEVBQ0FFLFFB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QTdFLE1BQUEyQyxJQUNBMkQsRUFBQTNELEdBQ0EsT0FBQUYsRUFBQUYsRUFBQWdGLElBR0FuRyxFQUFBTyxVQUFBckIsUUFBQSxTQUFBaUMsRUFBQUksRUFBQXBFLEVBQUFzRyxHQUNBLElBQUE4QyxFQUFBcEYsRUFBQTRDLFdBQ0FOLEVBQUFBLEVBQUE3RCxRQUFBNkQsRUFBQTdFLE9BQUEsRUFDQTJILEdBQUFoRixFQUFBa0MsRUFBQThDLEVBQUFuQixXQUFBL0gsU0FDQWtKLEdBQUFBLEdBQUFBLEVBQUFBLEVBQUFuQixXQUFBN0QsRUFBQWtDLEtBQUE4QyxFQUFBeEMsYUFBQXdDLEVBQUF4QyxjQUNBd0MsRUFBQXJILFFBQUEvQixJQWNBcUosR0FBQXJFLEVBQUFTLEVBQUEyQyxFQUFBLGFBR0EsT0FBQXZGIiwiZmlsZSI6ImZvcm0ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4vKiBcbkZPUiBUSEUgUFVSUE9TRVMgT0YgVEhJUyBBU1NJR05NRU5ULCBwbGVhc2UgY29uc2lkZXIgdGhlIFxuQVBJIGxpbmtlZCBhYm92ZSB0byBiZSBhIFwiYmxhY2tib3hcIiBBUEkgd2l0aCB0aGUgXG5mb2xsb3dpbmcgQ1JVRCBiZWhhdmlvcjpcblxuICAgIENyZWF0ZSBib29raW5nIHJlY29yZDpcbiAgICAtIEhUVFAgcmVxdWVzdDogICdQT1NUIC9hcGkvY3JlYXRlJ1xuICAgICAgICBwYXJhbXM6IGZvcm0gZGF0YSBhcyBKU09OIG9iamVjdFxuICAgIC0gUmVzcG9uc2U6IFxuICAgICAgICB7ICdtZXNzYWdlJzogPHN1Y2Nlc3MvZmFpbD4sICdkYXRhJzogPG5ld19kYXRhPiB9XG5cbiAgICBSZXRyaWV2ZSBib29raW5nIHJlY29yZDpcbiAgICAtIEhUVFAgcmVxdWVzdDogICdHRVQgL2FwaS9ib29raW5nLzxib29rX2lkPicgXG4gICAgICAgIHBhcmFtczogPGJvb2tfaWQ+LCB0aGUgSUQgb2YgdGhlIHJlY29yZCB0byBzZWFyY2ggZm9yXG4gICAgLSBSZXNwb25zZSAoSlNPTik6XG4gICAgICAgIHsgJ21lc3NhZ2UnOiA8c3VjY2Vzcy9mYWlsPiwgJ2RhdGEnOiA8Zm91bmRfZGF0YT4gfVxuXG4gICAgVXBkYXRlIGJvb2tpbmcgcmVjb3JkOlxuICAgIC0gSFRUUCByZXF1ZXN0OiAgJ1BVVCAvYXBpL2Jvb2tpbmcvPGJvb2tfaWQ+J1xuICAgICAgICBwYXJhbXM6IGZvcm0gZGF0YSBhcyBKU09OIG9iamVjdFxuICAgIC0gUmVzcG9uc2U6IFxuICAgICAgICB7ICdtZXNzYWdlJzogPHN1Y2Nlc3MvZmFpbD4sICdkYXRhJzogPG5ld19kYXRhPiB9XG5cbiAgICBEZWxldGUgYm9va2luZyByZWNvcmQ6XG4gICAgLSBIVFRQIHJlcXVlc3Q6ICAnREVMRVRFIC9hcGkvYm9va2luZy88Ym9va19pZD4nIFxuICAgICAgICBwYXJhbXM6IDxib29rX2lkPiwgdGhlIElEIG9mIHRoZSByZWNvcmQgdG8gYmUgZGVsZXRlZFxuICAgIC0gUmVzcG9uc2UgKEpTT04pOlxuICAgICAgICB7ICdtZXNzYWdlJzogPHN1Y2Nlc3MvZmFpbD4gfVxuKi9cblxuLy8gYXNzaWdubWVudCBjb2RlIGJlZ2lucyBoZXJlXG52YXIgYXBpU3RyaW5nID0gJ2h0dHBzOi8vY29tNjAxLWFzc2lnbjEuaGVyb2t1YXBwLmNvbS9hcGknO1xuXG4vLyBBSkFYIGZvciBjcmVhdGluZyBhbmQgdXBkYXRpbmcgYm9va2luZ3NcbmZ1bmN0aW9uIHN1Ym1pdEZvcm0oYm9va2luZywgb2xkSWQpIHtcbiAgICAvLyBmbGFnIGZvciB1cGRhdGluZyBvciBjcmVhdGluZ1xuICAgIHZhciB1cGRhdGVGbGFnID0gb2xkSWQgPT0gXCJcIiA/IGZhbHNlIDogdHJ1ZTtcbiAgICBjb25zb2xlLmxvZygndXBkYXRlPyAnICsgdXBkYXRlRmxhZyk7XG4gICAgdmFyIHBvc3REYXRhID0ge1xuICAgICAgICAnZmlyc3QnOiBib29raW5nLmZpcnN0LFxuICAgICAgICAnbGFzdCc6IGJvb2tpbmcubGFzdCxcbiAgICAgICAgJ2VtYWlsJzogYm9va2luZy5lbWFpbFxuICAgIH07XG5cbiAgICB2YXIgcXVlcnkgPSAnJztcbiAgICBpZiAodXBkYXRlRmxhZykge1xuICAgICAgICAvLyB1cGRhdGUgZXhpc3RpbmcgcmVjb3JkXG4gICAgICAgIHF1ZXJ5ID0gYXBpU3RyaW5nICsgJy9ib29raW5nLycgKyBvbGRJZDtcbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHVybDogcXVlcnksXG4gICAgICAgICAgICB0eXBlOiAnUFVUJyxcbiAgICAgICAgICAgIGRhdGE6IHBvc3REYXRhLFxuICAgICAgICAgICAgc3VjY2VzczogaGFuZGxlRWRpdFN1Y2Nlc3NcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gY3JlYXRlIG5ldyBib29raW5nIHJlY29yZFxuICAgICAgICBxdWVyeSA9IGFwaVN0cmluZyArICcvY3JlYXRlJztcbiAgICAgICAgJC5wb3N0KHF1ZXJ5LCBwb3N0RGF0YSwgaGFuZGxlRWRpdFN1Y2Nlc3MpO1xuICAgIH1cbiAgICAvLyBERUJVRzogcHJpbnQgQUpBWCBxdWVyeVxuICAgIGNvbnNvbGUubG9nKCdxdWVyeWluZzogJXMnLCBxdWVyeSk7XG59XG5cbi8vIGhhbmRsZSBBSkFYIENSRUFURSAmIFVQREFURSBzdWNjZXNzXG5mdW5jdGlvbiBoYW5kbGVFZGl0U3VjY2VzcyhyZXN1bHQsIHN0YXR1cywgcmVzcCkge1xuICAgIC8vIFRPRE86IGNoYW5nZSB0aGlzIHRvIGRpc3BsYXkgYmV0dGVyXG4gICAgLy8gREVCVUc6IHByaW50IEFKQVggcmVzdWx0IHN0YXR1cyBhbmQgZGF0YVxuICAgIGNvbnNvbGUubG9nKHJlc3VsdCwgc3RhdHVzLCByZXNwLnN0YXR1c1RleHQsIHJlc3Auc3RhdHVzKTtcbiAgICBpZiAocmVzcC5zdGF0dXMgPT0gMjAxKSB7XG4gICAgICAgIC8vIHByb2Nlc3Mgc3VjY2VzcyBwYWdlXG4gICAgICAgICQoJy5zdWNjZXNzLXBhZ2UgPiAuc2VjdGlvbi1oZWFkZXIgPiBoMycpLnRleHQoJ1RoYW5rIHlvdSEnKTtcbiAgICAgICAgJCgnI2Jvb2tlZC1pZCcpLnRleHQoJ1lvdXIgYm9va2luZyBJRDogJyArIHJlc3VsdC5kYXRhLmJvb2tfaWQpO1xuICAgICAgICAkKCcjYm9va2VkLW5hbWUnKS50ZXh0KCdSZWdpc3RlcmVkIG5hbWU6ICcgKyByZXN1bHQuZGF0YS5maXJzdCArICcgJyArIHJlc3VsdC5kYXRhLmxhc3QpO1xuICAgICAgICAkKCcjYm9va2VkLWVtYWlsJykudGV4dCgnRW1haWwgYWRkcmVzczogJyArIHJlc3VsdC5kYXRhLmVtYWlsKTtcbiAgICAgICAgJCgnLnN1Y2Nlc3MtcGFnZSA+IC5zZWN0aW9uLXdyYXBwZXIgPiBwJykuc2hvdygpO1xuXG4gICAgICAgIC8vIHNldCBtZXNzYWdlIGlmIHVwZGF0ZVxuICAgICAgICB2YXIgaWQgPSAkKCcjZm91bmQtaWQnKS52YWwoKTtcbiAgICAgICAgaWYgKGlkICE9IFwiXCIpIHtcbiAgICAgICAgICAgICQoJy5zdWNjZXNzLXBhZ2UgPiAuc2VjdGlvbi1oZWFkZXIgPiBwJykudGV4dChcIllvdXIgYWNjb21vZGF0aW9ucyBoYXZlIGJlZW4gdXBkYXRlZCBzdWNjZXNzZnVsbHkuIENoZWNrIG91dCB0aGUgZGV0YWlscyBiZWxvdzpcIik7XG4gICAgICAgICAgICAkKCcjZm91bmQtaWQnKS52YWwoJycpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCgnLnN1Y2Nlc3MtcGFnZSA+IC5zZWN0aW9uLWhlYWRlciA+IHAnKS50ZXh0KFwiWW91ciBhY2NvbW9kYXRpb25zIGhhdmUgYmVlbiBib29rZWQgc3VjY2Vzc2Z1bGx5LiBDaGVjayBvdXQgdGhlIGRldGFpbHMgYmVsb3c6XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgJCgnLmJvb2tpbmctZm9ybScpLmhpZGUoKTtcbiAgICAgICAgJCgnLnN1Y2Nlc3MtcGFnZScpLnNob3coKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBlcnJvciB0b29sdGlwc1xuICAgICAgICBpZiAoJCgnI2Vycm9ybXNnJykubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICQoJy5ib29raW5nLWZvcm0gLnNlY3Rpb24td3JhcHBlcicpLmFwcGVuZCgnPHAgaWQ9XCJlcnJvcm1zZ1wiPkxvb2tzIGxpa2UgdGhlcmUgd2FzIGFuIGVycm9yLCAlcyAlcyEgVHJ5IGFnYWluLjwvcD4nLCByZXNwLnN0YXR1cywgcmVzcC5zdGF0dXNUZXh0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFRPRE86IG1ha2UgdGhpcyBhbGwgYmV0dGVyXG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8vIEFKQVggZm9yIGNhbmNlbCBib29raW5nXG5mdW5jdGlvbiBjYW5jZWxCb29raW5nKGlkKSB7XG4gICAgdmFyIHF1ZXJ5ID0gYXBpU3RyaW5nICsgJy9ib29raW5nLycgKyBpZDtcbiAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IHF1ZXJ5LFxuICAgICAgICB0eXBlOiAnREVMRVRFJyxcbiAgICAgICAgc3VjY2VzczogaGFuZGxlRGVsZXRlU3VjY2Vzc1xuICAgIH0pO1xufVxuXG4vLyBoYW5kbGUgQUpBWCBERUxFVEUgc3VjY2Vzc1xuZnVuY3Rpb24gaGFuZGxlRGVsZXRlU3VjY2VzcygpIHtcbiAgICAvLyBzZXQgc3VjY2VzcyBwYWdlIHRleHRcbiAgICB2YXIgaWQgPSAkKCcjZm91bmQtaWQnKS52YWwoKTtcbiAgICAkKCcuc3VjY2Vzcy1wYWdlID4gLnNlY3Rpb24taGVhZGVyID4gaDMnKS50ZXh0KCdDYW5jZWxsZWQgcmVzZXJ2YXRpb24nKTtcbiAgICAkKCcuc3VjY2Vzcy1wYWdlID4gLnNlY3Rpb24td3JhcHBlciA+IHAnKS5oaWRlKCk7XG4gICAgJCgnLnN1Y2Nlc3MtcGFnZSA+IC5zZWN0aW9uLWhlYWRlciA+IHAnKS50ZXh0KFwiWW91ciBib29raW5nICgjXCIgKyBpZCArIFwiKSBoYXMgYmVlbiBjYW5jZWxsZWQuIFdlJ3JlIHNvcnJ5IHRvIHNlZSB5b3UgZ28hXCIpO1xuXG4gICAgLy8gc2hvdyBzdWNjZXNzIHBhZ2VcbiAgICAkKCcuYm9va2luZy1mb3JtJykuaGlkZSgpO1xuICAgICQoJy5zdWNjZXNzLXBhZ2UnKS5zaG93KCk7XG59XG5cbi8vIEFKQVggZm9yIGZpbmRpbmcgYm9va2luZ1xuZnVuY3Rpb24gZmluZEJ5UmVmKGlkKSB7XG4gICAgdmFyIHF1ZXJ5ID0gYXBpU3RyaW5nICsgJy9ib29raW5nLycgKyBpZDtcbiAgICAvLyBERUJVRzogcHJpbnQgQUpBWCBxdWVyeVxuICAgIC8vIGNvbnNvbGUubG9nKCdxdWVyeWluZzogJXMnLCBxdWVyeSk7XG4gICAgJC5nZXRKU09OKHF1ZXJ5LCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIC8vIERFQlVHOiBwcmludCByZXN1bHQgZGF0YVxuICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXN1bHQsIHJlc3VsdC5kYXRhKTtcbiAgICAgICAgaWYgKHJlc3VsdC5kYXRhKSB7XG4gICAgICAgICAgICAkKCcjZmlyc3RuYW1lJykudmFsKHJlc3VsdC5kYXRhLmZpcnN0KTtcbiAgICAgICAgICAgICQoJyNsYXN0bmFtZScpLnZhbChyZXN1bHQuZGF0YS5sYXN0KTtcbiAgICAgICAgICAgICQoJyNlbWFpbCcpLnZhbChyZXN1bHQuZGF0YS5lbWFpbCk7XG4gICAgICAgICAgICAkKCcjZm91bmQtaWQnKS52YWwocmVzdWx0LmRhdGEuYm9va19pZCk7XG5cbiAgICAgICAgICAgIC8vIGNoYW5nZSBoZWFkZXIgdGV4dCBhbmQgYnV0dG9uIHRleHRcbiAgICAgICAgICAgICQoJy5ib29raW5nLWZvcm0gPiAuc2VjdGlvbi1oZWFkZXIgPiBoMycpLnRleHQoJ1VwZGF0ZSB5b3VyIGJvb2tpbmcnKTtcbiAgICAgICAgICAgICQoJy5ib29raW5nLWZvcm0gPiAuc2VjdGlvbi1oZWFkZXIgPiBwJykudGV4dCgnV2UgZm91bmQgeW91ciBib29raW5nIHJlY29yZCwgJyArIHJlc3VsdC5kYXRhLmZpcnN0ICsgJy4gRmVlbCBmcmVlIHRvIGNoYW5nZSBhbnkgb2YgdGhlIGZpZWxkcyBiZWxvdyBpZiB5b3UgbmVlZCB0byB1cGRhdGUgaXQuJyk7XG4gICAgICAgICAgICAkKCcjc3VibWl0LWJ0bicpLnRleHQoJ1VwZGF0ZSBib29raW5nJyk7XG4gICAgICAgICAgICAkKCcuYm9va2luZy1mb3JtID4gLnNlY3Rpb24tZm9vdGVyID4gcCcpLmh0bWwoJ1dhbnQgdG8gc3RhcnQgb3Zlcj8gPGEgaHJlZj1cIiNcIiBjbGFzcz1cInNlYXJjaC1saW5rXCI+R28gYmFjazwvYT4nKTtcblxuICAgICAgICAgICAgLy8gY2FuY2VsIGxpbmtcbiAgICAgICAgICAgICQoJy5jYW5jZWwtbGluaycpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjYW5jZWxCb29raW5nKHJlc3VsdC5kYXRhLmJvb2tfaWQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoJy5jYW5jZWwtcHJvbXB0Jykuc2hvdygpO1xuICAgICAgICAgICAgJCgnLmJvb2tpbmctZm9ybScpLnNob3coKTtcbiAgICAgICAgICAgICQoJy5zZWFyY2gtZm9ybScpLmhpZGUoKTtcblxuICAgICAgICAgICAgLy8gcmUtaW5pdCBzZWFyY2ggbGluayBldmVudCBoYW5kbGVyXG4gICAgICAgICAgICAkKCcuc2VhcmNoLWxpbmsnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJCgnLmJvb2tpbmctZm9ybScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAkKCcuc2VhcmNoLWZvcm0nKS5zaG93KCk7XG4gICAgICAgICAgICB9KTskKCcjc2VhcmNoLWlucHV0JykudmFsKCcnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFRPRE86IFVzZSB0b29sdGlwIGhlcmVcbiAgICAgICAgICAgIC8vIERFQlVHOiBsb2cgaWYgSUQgbm90IGZvdW5kXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbm90IGZvdW5kIScpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbi8vIEFKQVggbG9hZGluZyBzcGlubmVycywgcG93ZXJlZCBieSBzcGluLmpzXG5mdW5jdGlvbiBzaG93U3Bpbm5lcigpIHtcbiAgICAkKCcuYWpheC1zcGlubmVyJykuc2hvdygpO1xufVxuXG5mdW5jdGlvbiBoaWRlU3Bpbm5lcigpIHtcbiAgICAkKCcuYWpheC1zcGlubmVyJykuaGlkZSgpO1xufVxuXG4vLyBET00gbWFuaXB1bGF0aW9uIGFmdGVyIGRvY3VtZW50IGlzIHJlYWR5XG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgLy8gaGlkZSBib29raW5nIGZvcm0gYW5kIHN1Y2Nlc3MgcGFnZVxuICAgICQoJy5ib29raW5nLWZvcm0nKS5oaWRlKCk7XG4gICAgJCgnLmNhbmNlbC1wcm9tcHQnKS5oaWRlKCk7XG4gICAgJCgnLnN1Y2Nlc3MtcGFnZScpLmhpZGUoKTtcbiAgICAkKCcuYWpheC1zcGlubmVyJykuaGlkZSgpO1xuXG4gICAgLy8gc3dpdGNoIHZpZXcgdG8gc2VhcmNoXG4gICAgJCgnLnNlYXJjaC1saW5rJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAkKCcuYm9va2luZy1mb3JtJykuaGlkZSgpO1xuICAgICAgICAkKCcuc2VhcmNoLWZvcm0nKS5zaG93KCk7XG4gICAgfSk7XG5cbiAgICAvLyBzd2l0Y2ggdmlldyB0byBib29raW5nIGZvcm1cbiAgICAkKCcuYm9va2luZy1saW5rJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBjbGVhciBmb3Jtc1xuICAgICAgICAkKCcjZmlyc3RuYW1lJykudmFsKCcnKTtcbiAgICAgICAgJCgnI2xhc3RuYW1lJykudmFsKCcnKTtcbiAgICAgICAgJCgnI2VtYWlsJykudmFsKCcnKTtcbiAgICAgICAgJCgnI3NlYXJjaC1pbnB1dCcpLnZhbCgnJyk7XG4gICAgICAgICQoJyNmb3VuZC1pZCcpLnZhbCgnJyk7XG4gICAgICAgICQoJy5jYW5jZWwtcHJvbXB0JykuaGlkZSgpO1xuXG4gICAgICAgIC8vIHJlc2V0IHRleHRcbiAgICAgICAgJCgnI3N1Ym1pdC1idG4nKS50ZXh0KCdSZXNlcnZlIG5vdycpO1xuICAgICAgICAkKCcuYm9va2luZy1mb3JtID4gLnNlY3Rpb24taGVhZGVyID4gaDMnKS50ZXh0KCdDcmVhdGUgYSBuZXcgYm9va2luZycpO1xuICAgICAgICAkKCcuYm9va2luZy1mb3JtID4gLnNlY3Rpb24taGVhZGVyID4gcCcpLnRleHQoJ0ZpbGwgb3V0IHRoZSBmaWVsZHMgYmVsb3cgdG8gYm9vayBhIG5ldyBhY2NvbW9kYXRpb24nKTtcbiAgICAgICAgJCgnLmJvb2tpbmctZm9ybSA+IC5zZWN0aW9uLWZvb3RlciA+IHAnKS5odG1sKCdBbHJlYWR5IGhhdmUgYWNjb21vZGF0aW9ucz8gPGEgaHJlZj1cIiNcIiBjbGFzcz1cInNlYXJjaC1saW5rXCI+TG9vayB1cCB5b3VyIGJvb2tpbmcgaGVyZSE8L2E+Jyk7XG4gICAgICAgICQoJy5zZWFyY2gtbGluaycpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoJy5ib29raW5nLWZvcm0nKS5oaWRlKCk7XG4gICAgICAgICAgICAkKCcuc2VhcmNoLWZvcm0nKS5zaG93KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy5ib29raW5nLWZvcm0nKS5zaG93KCk7XG4gICAgICAgICQoJy5zZWFyY2gtZm9ybScpLmhpZGUoKTtcbiAgICAgICAgJCgnLnN1Y2Nlc3MtcGFnZScpLmhpZGUoKTtcbiAgICB9KTtcblxuICAgIC8vIGFkZCBjbGljayBoYW5kbGVyIGZvciBzdWJtaXQgYnV0dG9uXG4gICAgdmFyIHN1Ym1pdEJ0biA9ICQoJyNzdWJtaXQtYnRuJyk7XG4gICAgc3VibWl0QnRuLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gZ2V0IGZvcm0gdmFsdWVzIGFuZCBzYXZlIHRvIG9iamVjdFxuICAgICAgICB2YXIgZmlyc3ROYW1lID0gJCgnI2ZpcnN0bmFtZScpLnZhbCgpO1xuICAgICAgICB2YXIgbGFzdE5hbWUgPSAkKCcjbGFzdG5hbWUnKS52YWwoKTtcbiAgICAgICAgdmFyIGVtYWlsID0gJCgnI2VtYWlsJykudmFsKCk7XG4gICAgICAgIHZhciBuZXdCb29raW5nID0ge1xuICAgICAgICAgICAgJ2ZpcnN0JzogZmlyc3ROYW1lLFxuICAgICAgICAgICAgJ2xhc3QnOiBsYXN0TmFtZSxcbiAgICAgICAgICAgICdlbWFpbCc6IGVtYWlsXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gdmFsaWRhdGUgZmllbGRzXG4gICAgICAgIGlmICghZmlyc3ROYW1lIHx8ICFsYXN0TmFtZSB8fCAhZW1haWwpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IHNob3cgdG9vbHRpcCwgY29uc29sZS5sb2cgZm9yIG5vd1xuICAgICAgICAgICAgLy8gVE9ETzogYmV0dGVyIGVtYWlsIGNsaWVudCB2YWxpZGF0aW9uXG4gICAgICAgICAgICAvLyBERUJVRzogbG9nIGlmIGZvcm0gaW5jb21wbGV0ZVxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJmb3JtIHZhbHVlcyBtaXNzaW5nIVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIHN1Ym1pdCBmb3JtIHdpdGggb2xkIElELCBpZiBmb3VuZFxuICAgICAgICAgICAgdmFyIG9sZElkID0gJCgnI2ZvdW5kLWlkJykudmFsKCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnYm9va2luZzogJywgbmV3Qm9va2luZywgb2xkSWQpO1xuICAgICAgICAgICAgc3VibWl0Rm9ybShuZXdCb29raW5nLCBvbGRJZCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGFkZCBjbGljayBoYW5kbGVyIGZvciBzZWFyY2ggYnV0dG9uXG4gICAgdmFyIHNlYXJjaEJ0biA9ICQoJyNzZWFyY2gtYnRuJyk7XG4gICAgc2VhcmNoQnRuLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlYXJjaElkID0gJCgnI3NlYXJjaC1pbnB1dCcpLnZhbCgpO1xuICAgICAgICBpZiAoIXNlYXJjaElkKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiByZXBsYWNlIHRoaXMgd2l0aCB0b29sdGlwXG4gICAgICAgICAgICAvLyBERUJVRzogbG9nIGlmIGZvcm0gaW5jb21wbGV0ZVxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJzZWFyY2ggSUQgbWlzc2luZyFcIiwgc2VhcmNoSWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gc2hvdyBzcGlubmVyXG4gICAgICAgICAgICBzaG93U3Bpbm5lcigpO1xuXG4gICAgICAgICAgICAvLyBzZWFyY2ggd2l0aCBJRFxuICAgICAgICAgICAgZmluZEJ5UmVmKHNlYXJjaElkKTtcblxuICAgICAgICAgICAgLy8gaGlkZSBzcGlubmVyXG4gICAgICAgICAgICBoaWRlU3Bpbm5lcigpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBoYW5kbGUgZW50ZXIga2V5IG9uIHNlYXJjaFxuICAgIHZhciBzZWFyY2hJbnAgPSAkKCcjc2VhcmNoLWlucHV0Jyk7XG4gICAgc2VhcmNoSW5wLmtleXByZXNzKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmIChlLmtleUNvZGUgPT0gMTMpIHtcbiAgICAgICAgICAgIHNlYXJjaEJ0bi5jbGljaygpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBoYW5kbGUgZW50ZXIga2V5IG9uIGZvcm1cbiAgICB2YXIgZm9ybUlucCA9ICQoJy5ib29raW5nLWZvcm0gPiAuc2VjdGlvbi13cmFwcGVyID4gaW5wdXQnKTtcbiAgICBmb3JtSW5wLmtleXByZXNzKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmIChlLmtleUNvZGUgPT0gMTMpIHtcbiAgICAgICAgICAgIHN1Ym1pdEJ0bi5jbGljaygpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBzZXQgdXAgQUpBWCBzcGlubmVyIGVsZW1lbnRcbiAgICB2YXIgb3B0cyA9IHsgbGluZXM6IDksIGxlbmd0aDogMzQsIHdpZHRoOiA2LCByYWRpdXM6IDI0LCBzY2FsZTogMSwgY29ybmVyczogMC4yLCBjb2xvcjogJyMwMDAnLCBvcGFjaXR5OiAwLjI1LCByb3RhdGU6IDAsIGRpcmVjdGlvbjogMSwgc3BlZWQ6IDAuOCwgdHJhaWw6IDI1LCBmcHM6IDIwLCB6SW5kZXg6IDJlOSwgY2xhc3NOYW1lOiAnc3Bpbm5lcicsIHRvcDogJzUwJScsIGxlZnQ6ICc1MCUnLCBzaGFkb3c6IGZhbHNlLCBod2FjY2VsOiB0cnVlLCBwb3NpdGlvbjogJ2Fic29sdXRlJyB9O1xuICAgIHZhciB0YXJnZXQgPSAkKCcuYWpheC1zcGlubmVyJyk7XG4gICAgdmFyIHNwaW5uZXIgPSBuZXcgU3Bpbm5lcihvcHRzKS5zcGluKHRhcmdldCk7XG59KTsiLCIndXNlIHN0cmljdCc7XG5cbnZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09IFwic3ltYm9sXCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajsgfTtcblxuLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTEtMjAxNCBGZWxpeCBHbmFzc1xuICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwOi8vc3Bpbi5qcy5vcmcvXG4gKlxuICogRXhhbXBsZTpcbiAgICB2YXIgb3B0cyA9IHtcbiAgICAgIGxpbmVzOiAxMiAgICAgICAgICAgICAvLyBUaGUgbnVtYmVyIG9mIGxpbmVzIHRvIGRyYXdcbiAgICAsIGxlbmd0aDogNyAgICAgICAgICAgICAvLyBUaGUgbGVuZ3RoIG9mIGVhY2ggbGluZVxuICAgICwgd2lkdGg6IDUgICAgICAgICAgICAgIC8vIFRoZSBsaW5lIHRoaWNrbmVzc1xuICAgICwgcmFkaXVzOiAxMCAgICAgICAgICAgIC8vIFRoZSByYWRpdXMgb2YgdGhlIGlubmVyIGNpcmNsZVxuICAgICwgc2NhbGU6IDEuMCAgICAgICAgICAgIC8vIFNjYWxlcyBvdmVyYWxsIHNpemUgb2YgdGhlIHNwaW5uZXJcbiAgICAsIGNvcm5lcnM6IDEgICAgICAgICAgICAvLyBSb3VuZG5lc3MgKDAuLjEpXG4gICAgLCBjb2xvcjogJyMwMDAnICAgICAgICAgLy8gI3JnYiBvciAjcnJnZ2JiXG4gICAgLCBvcGFjaXR5OiAxLzQgICAgICAgICAgLy8gT3BhY2l0eSBvZiB0aGUgbGluZXNcbiAgICAsIHJvdGF0ZTogMCAgICAgICAgICAgICAvLyBSb3RhdGlvbiBvZmZzZXRcbiAgICAsIGRpcmVjdGlvbjogMSAgICAgICAgICAvLyAxOiBjbG9ja3dpc2UsIC0xOiBjb3VudGVyY2xvY2t3aXNlXG4gICAgLCBzcGVlZDogMSAgICAgICAgICAgICAgLy8gUm91bmRzIHBlciBzZWNvbmRcbiAgICAsIHRyYWlsOiAxMDAgICAgICAgICAgICAvLyBBZnRlcmdsb3cgcGVyY2VudGFnZVxuICAgICwgZnBzOiAyMCAgICAgICAgICAgICAgIC8vIEZyYW1lcyBwZXIgc2Vjb25kIHdoZW4gdXNpbmcgc2V0VGltZW91dCgpXG4gICAgLCB6SW5kZXg6IDJlOSAgICAgICAgICAgLy8gVXNlIGEgaGlnaCB6LWluZGV4IGJ5IGRlZmF1bHRcbiAgICAsIGNsYXNzTmFtZTogJ3NwaW5uZXInICAvLyBDU1MgY2xhc3MgdG8gYXNzaWduIHRvIHRoZSBlbGVtZW50XG4gICAgLCB0b3A6ICc1MCUnICAgICAgICAgICAgLy8gY2VudGVyIHZlcnRpY2FsbHlcbiAgICAsIGxlZnQ6ICc1MCUnICAgICAgICAgICAvLyBjZW50ZXIgaG9yaXpvbnRhbGx5XG4gICAgLCBzaGFkb3c6IGZhbHNlICAgICAgICAgLy8gV2hldGhlciB0byByZW5kZXIgYSBzaGFkb3dcbiAgICAsIGh3YWNjZWw6IGZhbHNlICAgICAgICAvLyBXaGV0aGVyIHRvIHVzZSBoYXJkd2FyZSBhY2NlbGVyYXRpb24gKG1pZ2h0IGJlIGJ1Z2d5KVxuICAgICwgcG9zaXRpb246ICdhYnNvbHV0ZScgIC8vIEVsZW1lbnQgcG9zaXRpb25pbmdcbiAgICB9XG4gICAgdmFyIHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb28nKVxuICAgIHZhciBzcGlubmVyID0gbmV3IFNwaW5uZXIob3B0cykuc3Bpbih0YXJnZXQpXG4gKi9cbjsoZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHtcblxuICAvKiBDb21tb25KUyAqL1xuICBpZiAoKHR5cGVvZiBtb2R1bGUgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKG1vZHVsZSkpID09ICdvYmplY3QnICYmIG1vZHVsZS5leHBvcnRzKSBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblxuICAvKiBBTUQgbW9kdWxlICovXG4gIGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSBkZWZpbmUoZmFjdG9yeSk7XG5cbiAgICAvKiBCcm93c2VyIGdsb2JhbCAqL1xuICAgIGVsc2Ugcm9vdC5TcGlubmVyID0gZmFjdG9yeSgpO1xufSkodW5kZWZpbmVkLCBmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBwcmVmaXhlcyA9IFsnd2Via2l0JywgJ01veicsICdtcycsICdPJ10gLyogVmVuZG9yIHByZWZpeGVzICovXG4gICxcbiAgICAgIGFuaW1hdGlvbnMgPSB7fSAvKiBBbmltYXRpb24gcnVsZXMga2V5ZWQgYnkgdGhlaXIgbmFtZSAqL1xuICAsXG4gICAgICB1c2VDc3NBbmltYXRpb25zIC8qIFdoZXRoZXIgdG8gdXNlIENTUyBhbmltYXRpb25zIG9yIHNldFRpbWVvdXQgKi9cbiAgLFxuICAgICAgc2hlZXQ7IC8qIEEgc3R5bGVzaGVldCB0byBob2xkIHRoZSBAa2V5ZnJhbWUgb3IgVk1MIHJ1bGVzLiAqL1xuXG4gIC8qKlxuICAgKiBVdGlsaXR5IGZ1bmN0aW9uIHRvIGNyZWF0ZSBlbGVtZW50cy4gSWYgbm8gdGFnIG5hbWUgaXMgZ2l2ZW4sXG4gICAqIGEgRElWIGlzIGNyZWF0ZWQuIE9wdGlvbmFsbHkgcHJvcGVydGllcyBjYW4gYmUgcGFzc2VkLlxuICAgKi9cbiAgZnVuY3Rpb24gY3JlYXRlRWwodGFnLCBwcm9wKSB7XG4gICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcgfHwgJ2RpdicpLFxuICAgICAgICBuO1xuXG4gICAgZm9yIChuIGluIHByb3ApIHtcbiAgICAgIGVsW25dID0gcHJvcFtuXTtcbiAgICB9cmV0dXJuIGVsO1xuICB9XG5cbiAgLyoqXG4gICAqIEFwcGVuZHMgY2hpbGRyZW4gYW5kIHJldHVybnMgdGhlIHBhcmVudC5cbiAgICovXG4gIGZ1bmN0aW9uIGlucyhwYXJlbnQgLyogY2hpbGQxLCBjaGlsZDIsIC4uLiovKSB7XG4gICAgZm9yICh2YXIgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoYXJndW1lbnRzW2ldKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcGFyZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gb3BhY2l0eSBrZXlmcmFtZSBhbmltYXRpb24gcnVsZSBhbmQgcmV0dXJucyBpdHMgbmFtZS5cbiAgICogU2luY2UgbW9zdCBtb2JpbGUgV2Via2l0cyBoYXZlIHRpbWluZyBpc3N1ZXMgd2l0aCBhbmltYXRpb24tZGVsYXksXG4gICAqIHdlIGNyZWF0ZSBzZXBhcmF0ZSBydWxlcyBmb3IgZWFjaCBsaW5lL3NlZ21lbnQuXG4gICAqL1xuICBmdW5jdGlvbiBhZGRBbmltYXRpb24oYWxwaGEsIHRyYWlsLCBpLCBsaW5lcykge1xuICAgIHZhciBuYW1lID0gWydvcGFjaXR5JywgdHJhaWwsIH5+KGFscGhhICogMTAwKSwgaSwgbGluZXNdLmpvaW4oJy0nKSxcbiAgICAgICAgc3RhcnQgPSAwLjAxICsgaSAvIGxpbmVzICogMTAwLFxuICAgICAgICB6ID0gTWF0aC5tYXgoMSAtICgxIC0gYWxwaGEpIC8gdHJhaWwgKiAoMTAwIC0gc3RhcnQpLCBhbHBoYSksXG4gICAgICAgIHByZWZpeCA9IHVzZUNzc0FuaW1hdGlvbnMuc3Vic3RyaW5nKDAsIHVzZUNzc0FuaW1hdGlvbnMuaW5kZXhPZignQW5pbWF0aW9uJykpLnRvTG93ZXJDYXNlKCksXG4gICAgICAgIHByZSA9IHByZWZpeCAmJiAnLScgKyBwcmVmaXggKyAnLScgfHwgJyc7XG5cbiAgICBpZiAoIWFuaW1hdGlvbnNbbmFtZV0pIHtcbiAgICAgIHNoZWV0Lmluc2VydFJ1bGUoJ0AnICsgcHJlICsgJ2tleWZyYW1lcyAnICsgbmFtZSArICd7JyArICcwJXtvcGFjaXR5OicgKyB6ICsgJ30nICsgc3RhcnQgKyAnJXtvcGFjaXR5OicgKyBhbHBoYSArICd9JyArIChzdGFydCArIDAuMDEpICsgJyV7b3BhY2l0eToxfScgKyAoc3RhcnQgKyB0cmFpbCkgJSAxMDAgKyAnJXtvcGFjaXR5OicgKyBhbHBoYSArICd9JyArICcxMDAle29wYWNpdHk6JyArIHogKyAnfScgKyAnfScsIHNoZWV0LmNzc1J1bGVzLmxlbmd0aCk7XG5cbiAgICAgIGFuaW1hdGlvbnNbbmFtZV0gPSAxO1xuICAgIH1cblxuICAgIHJldHVybiBuYW1lO1xuICB9XG5cbiAgLyoqXG4gICAqIFRyaWVzIHZhcmlvdXMgdmVuZG9yIHByZWZpeGVzIGFuZCByZXR1cm5zIHRoZSBmaXJzdCBzdXBwb3J0ZWQgcHJvcGVydHkuXG4gICAqL1xuICBmdW5jdGlvbiB2ZW5kb3IoZWwsIHByb3ApIHtcbiAgICB2YXIgcyA9IGVsLnN0eWxlLFxuICAgICAgICBwcCxcbiAgICAgICAgaTtcblxuICAgIHByb3AgPSBwcm9wLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcHJvcC5zbGljZSgxKTtcbiAgICBpZiAoc1twcm9wXSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gcHJvcDtcbiAgICBmb3IgKGkgPSAwOyBpIDwgcHJlZml4ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHBwID0gcHJlZml4ZXNbaV0gKyBwcm9wO1xuICAgICAgaWYgKHNbcHBdICE9PSB1bmRlZmluZWQpIHJldHVybiBwcDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0cyBtdWx0aXBsZSBzdHlsZSBwcm9wZXJ0aWVzIGF0IG9uY2UuXG4gICAqL1xuICBmdW5jdGlvbiBjc3MoZWwsIHByb3ApIHtcbiAgICBmb3IgKHZhciBuIGluIHByb3ApIHtcbiAgICAgIGVsLnN0eWxlW3ZlbmRvcihlbCwgbikgfHwgbl0gPSBwcm9wW25dO1xuICAgIH1cblxuICAgIHJldHVybiBlbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaWxscyBpbiBkZWZhdWx0IHZhbHVlcy5cbiAgICovXG4gIGZ1bmN0aW9uIG1lcmdlKG9iaikge1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgZGVmID0gYXJndW1lbnRzW2ldO1xuICAgICAgZm9yICh2YXIgbiBpbiBkZWYpIHtcbiAgICAgICAgaWYgKG9ialtuXSA9PT0gdW5kZWZpbmVkKSBvYmpbbl0gPSBkZWZbbl07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgbGluZSBjb2xvciBmcm9tIHRoZSBnaXZlbiBzdHJpbmcgb3IgYXJyYXkuXG4gICAqL1xuICBmdW5jdGlvbiBnZXRDb2xvcihjb2xvciwgaWR4KSB7XG4gICAgcmV0dXJuIHR5cGVvZiBjb2xvciA9PSAnc3RyaW5nJyA/IGNvbG9yIDogY29sb3JbaWR4ICUgY29sb3IubGVuZ3RoXTtcbiAgfVxuXG4gIC8vIEJ1aWx0LWluIGRlZmF1bHRzXG5cbiAgdmFyIGRlZmF1bHRzID0ge1xuICAgIGxpbmVzOiAxMiAvLyBUaGUgbnVtYmVyIG9mIGxpbmVzIHRvIGRyYXdcbiAgICAsIGxlbmd0aDogNyAvLyBUaGUgbGVuZ3RoIG9mIGVhY2ggbGluZVxuICAgICwgd2lkdGg6IDUgLy8gVGhlIGxpbmUgdGhpY2tuZXNzXG4gICAgLCByYWRpdXM6IDEwIC8vIFRoZSByYWRpdXMgb2YgdGhlIGlubmVyIGNpcmNsZVxuICAgICwgc2NhbGU6IDEuMCAvLyBTY2FsZXMgb3ZlcmFsbCBzaXplIG9mIHRoZSBzcGlubmVyXG4gICAgLCBjb3JuZXJzOiAxIC8vIFJvdW5kbmVzcyAoMC4uMSlcbiAgICAsIGNvbG9yOiAnIzAwMCcgLy8gI3JnYiBvciAjcnJnZ2JiXG4gICAgLCBvcGFjaXR5OiAxIC8gNCAvLyBPcGFjaXR5IG9mIHRoZSBsaW5lc1xuICAgICwgcm90YXRlOiAwIC8vIFJvdGF0aW9uIG9mZnNldFxuICAgICwgZGlyZWN0aW9uOiAxIC8vIDE6IGNsb2Nrd2lzZSwgLTE6IGNvdW50ZXJjbG9ja3dpc2VcbiAgICAsIHNwZWVkOiAxIC8vIFJvdW5kcyBwZXIgc2Vjb25kXG4gICAgLCB0cmFpbDogMTAwIC8vIEFmdGVyZ2xvdyBwZXJjZW50YWdlXG4gICAgLCBmcHM6IDIwIC8vIEZyYW1lcyBwZXIgc2Vjb25kIHdoZW4gdXNpbmcgc2V0VGltZW91dCgpXG4gICAgLCB6SW5kZXg6IDJlOSAvLyBVc2UgYSBoaWdoIHotaW5kZXggYnkgZGVmYXVsdFxuICAgICwgY2xhc3NOYW1lOiAnc3Bpbm5lcicgLy8gQ1NTIGNsYXNzIHRvIGFzc2lnbiB0byB0aGUgZWxlbWVudFxuICAgICwgdG9wOiAnNTAlJyAvLyBjZW50ZXIgdmVydGljYWxseVxuICAgICwgbGVmdDogJzUwJScgLy8gY2VudGVyIGhvcml6b250YWxseVxuICAgICwgc2hhZG93OiBmYWxzZSAvLyBXaGV0aGVyIHRvIHJlbmRlciBhIHNoYWRvd1xuICAgICwgaHdhY2NlbDogZmFsc2UgLy8gV2hldGhlciB0byB1c2UgaGFyZHdhcmUgYWNjZWxlcmF0aW9uIChtaWdodCBiZSBidWdneSlcbiAgICAsIHBvc2l0aW9uOiAnYWJzb2x1dGUnIC8vIEVsZW1lbnQgcG9zaXRpb25pbmdcblxuXG4gICAgLyoqIFRoZSBjb25zdHJ1Y3RvciAqL1xuICB9O2Z1bmN0aW9uIFNwaW5uZXIobykge1xuICAgIHRoaXMub3B0cyA9IG1lcmdlKG8gfHwge30sIFNwaW5uZXIuZGVmYXVsdHMsIGRlZmF1bHRzKTtcbiAgfVxuXG4gIC8vIEdsb2JhbCBkZWZhdWx0cyB0aGF0IG92ZXJyaWRlIHRoZSBidWlsdC1pbnM6XG4gIFNwaW5uZXIuZGVmYXVsdHMgPSB7fTtcblxuICBtZXJnZShTcGlubmVyLnByb3RvdHlwZSwge1xuICAgIC8qKlxuICAgICAqIEFkZHMgdGhlIHNwaW5uZXIgdG8gdGhlIGdpdmVuIHRhcmdldCBlbGVtZW50LiBJZiB0aGlzIGluc3RhbmNlIGlzIGFscmVhZHlcbiAgICAgKiBzcGlubmluZywgaXQgaXMgYXV0b21hdGljYWxseSByZW1vdmVkIGZyb20gaXRzIHByZXZpb3VzIHRhcmdldCBiIGNhbGxpbmdcbiAgICAgKiBzdG9wKCkgaW50ZXJuYWxseS5cbiAgICAgKi9cbiAgICBzcGluOiBmdW5jdGlvbiBzcGluKHRhcmdldCkge1xuICAgICAgdGhpcy5zdG9wKCk7XG5cbiAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgICBvID0gc2VsZi5vcHRzLFxuICAgICAgICAgIGVsID0gc2VsZi5lbCA9IGNyZWF0ZUVsKG51bGwsIHsgY2xhc3NOYW1lOiBvLmNsYXNzTmFtZSB9KTtcblxuICAgICAgY3NzKGVsLCB7XG4gICAgICAgIHBvc2l0aW9uOiBvLnBvc2l0aW9uLFxuICAgICAgICB3aWR0aDogMCxcbiAgICAgICAgekluZGV4OiBvLnpJbmRleCxcbiAgICAgICAgbGVmdDogby5sZWZ0LFxuICAgICAgICB0b3A6IG8udG9wXG4gICAgICB9KTtcblxuICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICB0YXJnZXQuaW5zZXJ0QmVmb3JlKGVsLCB0YXJnZXQuZmlyc3RDaGlsZCB8fCBudWxsKTtcbiAgICAgIH1cblxuICAgICAgZWwuc2V0QXR0cmlidXRlKCdyb2xlJywgJ3Byb2dyZXNzYmFyJyk7XG4gICAgICBzZWxmLmxpbmVzKGVsLCBzZWxmLm9wdHMpO1xuXG4gICAgICBpZiAoIXVzZUNzc0FuaW1hdGlvbnMpIHtcbiAgICAgICAgLy8gTm8gQ1NTIGFuaW1hdGlvbiBzdXBwb3J0LCB1c2Ugc2V0VGltZW91dCgpIGluc3RlYWRcbiAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgc3RhcnQgPSAoby5saW5lcyAtIDEpICogKDEgLSBvLmRpcmVjdGlvbikgLyAyLFxuICAgICAgICAgICAgYWxwaGEsXG4gICAgICAgICAgICBmcHMgPSBvLmZwcyxcbiAgICAgICAgICAgIGYgPSBmcHMgLyBvLnNwZWVkLFxuICAgICAgICAgICAgb3N0ZXAgPSAoMSAtIG8ub3BhY2l0eSkgLyAoZiAqIG8udHJhaWwgLyAxMDApLFxuICAgICAgICAgICAgYXN0ZXAgPSBmIC8gby5saW5lczsoZnVuY3Rpb24gYW5pbSgpIHtcbiAgICAgICAgICBpKys7XG4gICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvLmxpbmVzOyBqKyspIHtcbiAgICAgICAgICAgIGFscGhhID0gTWF0aC5tYXgoMSAtIChpICsgKG8ubGluZXMgLSBqKSAqIGFzdGVwKSAlIGYgKiBvc3RlcCwgby5vcGFjaXR5KTtcblxuICAgICAgICAgICAgc2VsZi5vcGFjaXR5KGVsLCBqICogby5kaXJlY3Rpb24gKyBzdGFydCwgYWxwaGEsIG8pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZWxmLnRpbWVvdXQgPSBzZWxmLmVsICYmIHNldFRpbWVvdXQoYW5pbSwgfn4oMTAwMCAvIGZwcykpO1xuICAgICAgICB9KSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHNlbGY7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU3RvcHMgYW5kIHJlbW92ZXMgdGhlIFNwaW5uZXIuXG4gICAgICovXG4gICAgLCBzdG9wOiBmdW5jdGlvbiBzdG9wKCkge1xuICAgICAgdmFyIGVsID0gdGhpcy5lbDtcbiAgICAgIGlmIChlbCkge1xuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KTtcbiAgICAgICAgaWYgKGVsLnBhcmVudE5vZGUpIGVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWwpO1xuICAgICAgICB0aGlzLmVsID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgbWV0aG9kIHRoYXQgZHJhd3MgdGhlIGluZGl2aWR1YWwgbGluZXMuIFdpbGwgYmUgb3ZlcndyaXR0ZW5cbiAgICAgKiBpbiBWTUwgZmFsbGJhY2sgbW9kZSBiZWxvdy5cbiAgICAgKi9cbiAgICAsIGxpbmVzOiBmdW5jdGlvbiBsaW5lcyhlbCwgbykge1xuICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgIHN0YXJ0ID0gKG8ubGluZXMgLSAxKSAqICgxIC0gby5kaXJlY3Rpb24pIC8gMixcbiAgICAgICAgICBzZWc7XG5cbiAgICAgIGZ1bmN0aW9uIGZpbGwoY29sb3IsIHNoYWRvdykge1xuICAgICAgICByZXR1cm4gY3NzKGNyZWF0ZUVsKCksIHtcbiAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICB3aWR0aDogby5zY2FsZSAqIChvLmxlbmd0aCArIG8ud2lkdGgpICsgJ3B4JyxcbiAgICAgICAgICBoZWlnaHQ6IG8uc2NhbGUgKiBvLndpZHRoICsgJ3B4JyxcbiAgICAgICAgICBiYWNrZ3JvdW5kOiBjb2xvcixcbiAgICAgICAgICBib3hTaGFkb3c6IHNoYWRvdyxcbiAgICAgICAgICB0cmFuc2Zvcm1PcmlnaW46ICdsZWZ0JyxcbiAgICAgICAgICB0cmFuc2Zvcm06ICdyb3RhdGUoJyArIH5+KDM2MCAvIG8ubGluZXMgKiBpICsgby5yb3RhdGUpICsgJ2RlZykgdHJhbnNsYXRlKCcgKyBvLnNjYWxlICogby5yYWRpdXMgKyAncHgnICsgJywwKScsXG4gICAgICAgICAgYm9yZGVyUmFkaXVzOiAoby5jb3JuZXJzICogby5zY2FsZSAqIG8ud2lkdGggPj4gMSkgKyAncHgnXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmb3IgKDsgaSA8IG8ubGluZXM7IGkrKykge1xuICAgICAgICBzZWcgPSBjc3MoY3JlYXRlRWwoKSwge1xuICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgIHRvcDogMSArIH4oby5zY2FsZSAqIG8ud2lkdGggLyAyKSArICdweCcsXG4gICAgICAgICAgdHJhbnNmb3JtOiBvLmh3YWNjZWwgPyAndHJhbnNsYXRlM2QoMCwwLDApJyA6ICcnLFxuICAgICAgICAgIG9wYWNpdHk6IG8ub3BhY2l0eSxcbiAgICAgICAgICBhbmltYXRpb246IHVzZUNzc0FuaW1hdGlvbnMgJiYgYWRkQW5pbWF0aW9uKG8ub3BhY2l0eSwgby50cmFpbCwgc3RhcnQgKyBpICogby5kaXJlY3Rpb24sIG8ubGluZXMpICsgJyAnICsgMSAvIG8uc3BlZWQgKyAncyBsaW5lYXIgaW5maW5pdGUnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChvLnNoYWRvdykgaW5zKHNlZywgY3NzKGZpbGwoJyMwMDAnLCAnMCAwIDRweCAjMDAwJyksIHsgdG9wOiAnMnB4JyB9KSk7XG4gICAgICAgIGlucyhlbCwgaW5zKHNlZywgZmlsbChnZXRDb2xvcihvLmNvbG9yLCBpKSwgJzAgMCAxcHggcmdiYSgwLDAsMCwuMSknKSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGVsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEludGVybmFsIG1ldGhvZCB0aGF0IGFkanVzdHMgdGhlIG9wYWNpdHkgb2YgYSBzaW5nbGUgbGluZS5cbiAgICAgKiBXaWxsIGJlIG92ZXJ3cml0dGVuIGluIFZNTCBmYWxsYmFjayBtb2RlIGJlbG93LlxuICAgICAqL1xuICAgICwgb3BhY2l0eTogZnVuY3Rpb24gb3BhY2l0eShlbCwgaSwgdmFsKSB7XG4gICAgICBpZiAoaSA8IGVsLmNoaWxkTm9kZXMubGVuZ3RoKSBlbC5jaGlsZE5vZGVzW2ldLnN0eWxlLm9wYWNpdHkgPSB2YWw7XG4gICAgfVxuXG4gIH0pO1xuXG4gIGZ1bmN0aW9uIGluaXRWTUwoKSB7XG5cbiAgICAvKiBVdGlsaXR5IGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIFZNTCB0YWcgKi9cbiAgICBmdW5jdGlvbiB2bWwodGFnLCBhdHRyKSB7XG4gICAgICByZXR1cm4gY3JlYXRlRWwoJzwnICsgdGFnICsgJyB4bWxucz1cInVybjpzY2hlbWFzLW1pY3Jvc29mdC5jb206dm1sXCIgY2xhc3M9XCJzcGluLXZtbFwiPicsIGF0dHIpO1xuICAgIH1cblxuICAgIC8vIE5vIENTUyB0cmFuc2Zvcm1zIGJ1dCBWTUwgc3VwcG9ydCwgYWRkIGEgQ1NTIHJ1bGUgZm9yIFZNTCBlbGVtZW50czpcbiAgICBzaGVldC5hZGRSdWxlKCcuc3Bpbi12bWwnLCAnYmVoYXZpb3I6dXJsKCNkZWZhdWx0I1ZNTCknKTtcblxuICAgIFNwaW5uZXIucHJvdG90eXBlLmxpbmVzID0gZnVuY3Rpb24gKGVsLCBvKSB7XG4gICAgICB2YXIgciA9IG8uc2NhbGUgKiAoby5sZW5ndGggKyBvLndpZHRoKSxcbiAgICAgICAgICBzID0gby5zY2FsZSAqIDIgKiByO1xuXG4gICAgICBmdW5jdGlvbiBncnAoKSB7XG4gICAgICAgIHJldHVybiBjc3Modm1sKCdncm91cCcsIHtcbiAgICAgICAgICBjb29yZHNpemU6IHMgKyAnICcgKyBzLFxuICAgICAgICAgIGNvb3Jkb3JpZ2luOiAtciArICcgJyArIC1yXG4gICAgICAgIH0pLCB7IHdpZHRoOiBzLCBoZWlnaHQ6IHMgfSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBtYXJnaW4gPSAtKG8ud2lkdGggKyBvLmxlbmd0aCkgKiBvLnNjYWxlICogMiArICdweCcsXG4gICAgICAgICAgZyA9IGNzcyhncnAoKSwgeyBwb3NpdGlvbjogJ2Fic29sdXRlJywgdG9wOiBtYXJnaW4sIGxlZnQ6IG1hcmdpbiB9KSxcbiAgICAgICAgICBpO1xuXG4gICAgICBmdW5jdGlvbiBzZWcoaSwgZHgsIGZpbHRlcikge1xuICAgICAgICBpbnMoZywgaW5zKGNzcyhncnAoKSwgeyByb3RhdGlvbjogMzYwIC8gby5saW5lcyAqIGkgKyAnZGVnJywgbGVmdDogfn5keCB9KSwgaW5zKGNzcyh2bWwoJ3JvdW5kcmVjdCcsIHsgYXJjc2l6ZTogby5jb3JuZXJzIH0pLCB7IHdpZHRoOiByLFxuICAgICAgICAgIGhlaWdodDogby5zY2FsZSAqIG8ud2lkdGgsXG4gICAgICAgICAgbGVmdDogby5zY2FsZSAqIG8ucmFkaXVzLFxuICAgICAgICAgIHRvcDogLW8uc2NhbGUgKiBvLndpZHRoID4+IDEsXG4gICAgICAgICAgZmlsdGVyOiBmaWx0ZXJcbiAgICAgICAgfSksIHZtbCgnZmlsbCcsIHsgY29sb3I6IGdldENvbG9yKG8uY29sb3IsIGkpLCBvcGFjaXR5OiBvLm9wYWNpdHkgfSksIHZtbCgnc3Ryb2tlJywgeyBvcGFjaXR5OiAwIH0pIC8vIHRyYW5zcGFyZW50IHN0cm9rZSB0byBmaXggY29sb3IgYmxlZWRpbmcgdXBvbiBvcGFjaXR5IGNoYW5nZVxuICAgICAgICApKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChvLnNoYWRvdykgZm9yIChpID0gMTsgaSA8PSBvLmxpbmVzOyBpKyspIHtcbiAgICAgICAgc2VnKGksIC0yLCAncHJvZ2lkOkRYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0LkJsdXIocGl4ZWxyYWRpdXM9MixtYWtlc2hhZG93PTEsc2hhZG93b3BhY2l0eT0uMyknKTtcbiAgICAgIH1cblxuICAgICAgZm9yIChpID0gMTsgaSA8PSBvLmxpbmVzOyBpKyspIHtcbiAgICAgICAgc2VnKGkpO1xuICAgICAgfXJldHVybiBpbnMoZWwsIGcpO1xuICAgIH07XG5cbiAgICBTcGlubmVyLnByb3RvdHlwZS5vcGFjaXR5ID0gZnVuY3Rpb24gKGVsLCBpLCB2YWwsIG8pIHtcbiAgICAgIHZhciBjID0gZWwuZmlyc3RDaGlsZDtcbiAgICAgIG8gPSBvLnNoYWRvdyAmJiBvLmxpbmVzIHx8IDA7XG4gICAgICBpZiAoYyAmJiBpICsgbyA8IGMuY2hpbGROb2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgYyA9IGMuY2hpbGROb2Rlc1tpICsgb107YyA9IGMgJiYgYy5maXJzdENoaWxkO2MgPSBjICYmIGMuZmlyc3RDaGlsZDtcbiAgICAgICAgaWYgKGMpIGMub3BhY2l0eSA9IHZhbDtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBzaGVldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlbCA9IGNyZWF0ZUVsKCdzdHlsZScsIHsgdHlwZTogJ3RleHQvY3NzJyB9KTtcbiAgICAgIGlucyhkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLCBlbCk7XG4gICAgICByZXR1cm4gZWwuc2hlZXQgfHwgZWwuc3R5bGVTaGVldDtcbiAgICB9KCk7XG5cbiAgICB2YXIgcHJvYmUgPSBjc3MoY3JlYXRlRWwoJ2dyb3VwJyksIHsgYmVoYXZpb3I6ICd1cmwoI2RlZmF1bHQjVk1MKScgfSk7XG5cbiAgICBpZiAoIXZlbmRvcihwcm9iZSwgJ3RyYW5zZm9ybScpICYmIHByb2JlLmFkaikgaW5pdFZNTCgpO2Vsc2UgdXNlQ3NzQW5pbWF0aW9ucyA9IHZlbmRvcihwcm9iZSwgJ2FuaW1hdGlvbicpO1xuICB9XG5cbiAgcmV0dXJuIFNwaW5uZXI7XG59KTsiXX0=
