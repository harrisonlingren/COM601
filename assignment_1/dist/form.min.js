"use strict";function submitForm(e,o){var t=""!=o;console.log("update? "+t);var i={first:e.first,last:e.last,email:e.email},n="";showSpinner(),t?(n=apiString+"/booking/"+o,$.ajax({url:n,type:"PUT",data:i,success:handleEditSuccess})):(n=apiString+"/create",$.post(n,i,handleEditSuccess)),hideSpinner()}function handleEditSuccess(e,o,t){console.log(e,o,t.statusText,t.status),201==t.status?($(".success-page > .section-header > h3").text("Thank you!"),$("#booked-id").text("Your booking ID: "+e.data.book_id),$("#booked-name").text("Registered name: "+e.data.first+" "+e.data.last),$("#booked-email").text("Email address: "+e.data.email),$(".success-page > .section-wrapper > p").show(),""!=$("#found-id").val()?($(".success-page > .section-header > p").text("Your accomodations have been updated successfully. Check out the details below:"),$("#found-id").val("")):$(".success-page > .section-header > p").text("Your accomodations have been booked successfully. Check out the details below:"),$(".booking-form").hide(),$(".success-page").show()):0==$("#errormsg").length&&$(".booking-form .section-wrapper").append('<p id="errormsg">Looks like there was an error, %s %s! Try again.</p>',t.status,t.statusText)}function cancelBooking(e){var o=apiString+"/booking/"+e;showSpinner(),$.ajax({url:o,type:"DELETE",success:handleDeleteSuccess}),hideSpinner()}function handleDeleteSuccess(){var e=$("#found-id").val();$(".success-page > .section-header > h3").text("Cancelled reservation"),$(".success-page > .section-wrapper > p").hide(),$(".success-page > .section-header > p").text("Your booking (#"+e+") has been cancelled. We're sorry to see you go!"),$(".booking-form").hide(),$(".success-page").show()}function findByRef(e){var o=apiString+"/booking/"+e;$.getJSON(o,function(e){e.data?($("#firstname").val(e.data.first),$("#lastname").val(e.data.last),$("#email").val(e.data.email),$("#found-id").val(e.data.book_id),$(".booking-form > .section-header > h3").text("Update your booking"),$(".booking-form > .section-header > p").text("We found your booking record, "+e.data.first+". Feel free to change any of the fields below if you need to update it."),$("#submit-btn").text("Update booking"),$(".booking-form > .section-footer > p").html('Want to start over? <a href="#" class="search-link">Go back</a>'),$(".cancel-link").click(function(){cancelBooking(e.data.book_id)}),$(".cancel-prompt").show(),$(".booking-form").show(),$(".search-form").hide(),$(".search-link").click(function(){$(".booking-form").hide(),$(".search-form").show()}),$("#search-input").val("")):console.log("not found!")})}function showSpinner(){console.info("showing spinner..."),$(".spinner").show()}function hideSpinner(){console.info("hiding spinner..."),$(".spinner").hide()}var apiString="https://com601-assign1.herokuapp.com/api";$(document).ready(function(){$(".booking-form").hide(),$(".cancel-prompt").hide(),$(".success-page").hide(),$(".spinner").hide(),$(".search-link").click(function(){$(".booking-form").hide(),$(".search-form").show()}),$(".booking-link").click(function(){$("#firstname").val(""),$("#lastname").val(""),$("#email").val(""),$("#search-input").val(""),$("#found-id").val(""),$(".cancel-prompt").hide(),$("#submit-btn").text("Reserve now"),$(".booking-form > .section-header > h3").text("Create a new booking"),$(".booking-form > .section-header > p").text("Fill out the fields below to book a new accomodation"),$(".booking-form > .section-footer > p").html('Already have accomodations? <a href="#" class="search-link">Look up your booking here!</a>'),$(".search-link").click(function(){$(".booking-form").hide(),$(".search-form").show()}),$(".booking-form").show(),$(".search-form").hide(),$(".success-page").hide()});var e=$("#submit-btn");e.click(function(){var e=$("#firstname").val(),o=$("#lastname").val(),t=$("#email").val(),i={first:e,last:o,email:t};if(e&&o&&t){var n=$("#found-id").val();console.log("booking: ",i,n),submitForm(i,n)}else console.log("form values missing!")});var o=$("#search-btn");o.click(function(){var e=$("#search-input").val();e?(showSpinner(),findByRef(e),hideSpinner()):console.log("search ID missing!",e)}),$("#search-input").keypress(function(e){13==e.keyCode&&o.click()}),$(".booking-form > .section-wrapper > input").keypress(function(o){13==o.keyCode&&e.click()});var t={lines:9,length:34,width:6,radius:24,scale:1,corners:.2,color:"#000",opacity:.25,rotate:0,direction:1,speed:.8,trail:25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!0,position:"absolute"},i=$(".container"),n=new Spinner(t).spin();i.append(n.el),hideSpinner()});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,o){"object"==("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=o():"function"==typeof define&&define.amd?define(o):e.Spinner=o()}(void 0,function(){function e(e,o){var t,i=document.createElement(e||"div");for(t in o)i[t]=o[t];return i}function o(e){for(var o=1,t=arguments.length;o<t;o++)e.appendChild(arguments[o]);return e}function t(e,o,t,i){var n=["opacity",o,~~(100*e),t,i].join("-"),a=.01+t/i*100,s=Math.max(1-(1-e)/o*(100-a),e),r=c.substring(0,c.indexOf("Animation")).toLowerCase(),d=r&&"-"+r+"-"||"";return p[n]||(l.insertRule("@"+d+"keyframes "+n+"{0%{opacity:"+s+"}"+a+"%{opacity:"+e+"}"+(a+.01)+"%{opacity:1}"+(a+o)%100+"%{opacity:"+e+"}100%{opacity:"+s+"}}",l.cssRules.length),p[n]=1),n}function i(e,o){var t,i,n=e.style;if(o=o.charAt(0).toUpperCase()+o.slice(1),void 0!==n[o])return o;for(i=0;i<d.length;i++)if(t=d[i]+o,void 0!==n[t])return t}function n(e,o){for(var t in o)e.style[i(e,t)||t]=o[t];return e}function a(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var i in t)void 0===e[i]&&(e[i]=t[i])}return e}function s(e,o){return"string"==typeof e?e:e[o%e.length]}function r(e){this.opts=a(e||{},r.defaults,u)}var c,l,d=["webkit","Moz","ms","O"],p={},u={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(r.defaults={},a(r.prototype,{spin:function(o){this.stop();var t=this,i=t.opts,a=t.el=e(null,{className:i.className});if(n(a,{position:i.position,width:0,zIndex:i.zIndex,left:i.left,top:i.top}),o&&o.insertBefore(a,o.firstChild||null),a.setAttribute("role","progressbar"),t.lines(a,t.opts),!c){var s,r=0,l=(i.lines-1)*(1-i.direction)/2,d=i.fps,p=d/i.speed,u=(1-i.opacity)/(p*i.trail/100),f=p/i.lines;!function e(){r++;for(var o=0;o<i.lines;o++)s=Math.max(1-(r+(i.lines-o)*f)%p*u,i.opacity),t.opacity(a,o*i.direction+l,s,i);t.timeout=t.el&&setTimeout(e,~~(1e3/d))}()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(i,a){function r(o,t){return n(e(),{position:"absolute",width:a.scale*(a.length+a.width)+"px",height:a.scale*a.width+"px",background:o,boxShadow:t,transformOrigin:"left",transform:"rotate("+~~(360/a.lines*d+a.rotate)+"deg) translate("+a.scale*a.radius+"px,0)",borderRadius:(a.corners*a.scale*a.width>>1)+"px"})}for(var l,d=0,p=(a.lines-1)*(1-a.direction)/2;d<a.lines;d++)l=n(e(),{position:"absolute",top:1+~(a.scale*a.width/2)+"px",transform:a.hwaccel?"translate3d(0,0,0)":"",opacity:a.opacity,animation:c&&t(a.opacity,a.trail,p+d*a.direction,a.lines)+" "+1/a.speed+"s linear infinite"}),a.shadow&&o(l,n(r("#000","0 0 4px #000"),{top:"2px"})),o(i,o(l,r(s(a.color,d),"0 0 1px rgba(0,0,0,.1)")));return i},opacity:function(e,o,t){o<e.childNodes.length&&(e.childNodes[o].style.opacity=t)}}),"undefined"!=typeof document){l=function(){var t=e("style",{type:"text/css"});return o(document.getElementsByTagName("head")[0],t),t.sheet||t.styleSheet}();var f=n(e("group"),{behavior:"url(#default#VML)"});!i(f,"transform")&&f.adj?function(){function t(o,t){return e("<"+o+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}l.addRule(".spin-vml","behavior:url(#default#VML)"),r.prototype.lines=function(e,i){function a(){return n(t("group",{coordsize:d+" "+d,coordorigin:-l+" "+-l}),{width:d,height:d})}function r(e,r,c){o(u,o(n(a(),{rotation:360/i.lines*e+"deg",left:~~r}),o(n(t("roundrect",{arcsize:i.corners}),{width:l,height:i.scale*i.width,left:i.scale*i.radius,top:-i.scale*i.width>>1,filter:c}),t("fill",{color:s(i.color,e),opacity:i.opacity}),t("stroke",{opacity:0}))))}var c,l=i.scale*(i.length+i.width),d=2*i.scale*l,p=-(i.width+i.length)*i.scale*2+"px",u=n(a(),{position:"absolute",top:p,left:p});if(i.shadow)for(c=1;c<=i.lines;c++)r(c,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(c=1;c<=i.lines;c++)r(c);return o(e,u)},r.prototype.opacity=function(e,o,t,i){var n=e.firstChild;i=i.shadow&&i.lines||0,n&&o+i<n.childNodes.length&&(n=(n=(n=n.childNodes[o+i])&&n.firstChild)&&n.firstChild)&&(n.opacity=t)}}():c=i(f,"animation")}return r});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZvcm0uanMiLCJzcGluLmpzIl0sIm5hbWVzIjpbInN1Ym1pdEZvcm0iLCJib29raW5nIiwib2xkSWQiLCJ1cGRhdGVGbGFnIiwiY29uc29sZSIsImxvZyIsInBvc3REYXRhIiwiZmlyc3QiLCJsYXN0IiwiZW1haWwiLCJxdWVyeSIsInNob3dTcGlubmVyIiwiYXBpU3RyaW5nIiwiJCIsImFqYXgiLCJ1cmwiLCJ0eXBlIiwiZGF0YSIsInN1Y2Nlc3MiLCJoYW5kbGVFZGl0U3VjY2VzcyIsInBvc3QiLCJoaWRlU3Bpbm5lciIsInJlc3VsdCIsInN0YXR1cyIsInJlc3AiLCJzdGF0dXNUZXh0IiwidGV4dCIsImJvb2tfaWQiLCJzaG93IiwidmFsIiwiaGlkZSIsImxlbmd0aCIsImFwcGVuZCIsImNhbmNlbEJvb2tpbmciLCJpZCIsImhhbmRsZURlbGV0ZVN1Y2Nlc3MiLCJmaW5kQnlSZWYiLCJnZXRKU09OIiwiaHRtbCIsImNsaWNrIiwiaW5mbyIsImRvY3VtZW50IiwicmVhZHkiLCJzdWJtaXRCdG4iLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsIm5ld0Jvb2tpbmciLCJzZWFyY2hCdG4iLCJzZWFyY2hJZCIsImtleXByZXNzIiwiZSIsImtleUNvZGUiLCJvcHRzIiwibGluZXMiLCJ3aWR0aCIsInJhZGl1cyIsInNjYWxlIiwiY29ybmVycyIsImNvbG9yIiwib3BhY2l0eSIsInJvdGF0ZSIsImRpcmVjdGlvbiIsInNwZWVkIiwidHJhaWwiLCJmcHMiLCJ6SW5kZXgiLCJjbGFzc05hbWUiLCJ0b3AiLCJsZWZ0Iiwic2hhZG93IiwiaHdhY2NlbCIsInBvc2l0aW9uIiwidGFyZ2V0IiwicyIsIlNwaW5uZXIiLCJzcGluIiwiZWwiLCJfdHlwZW9mIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJvYmoiLCJjb25zdHJ1Y3RvciIsInByb3RvdHlwZSIsInJvb3QiLCJmYWN0b3J5IiwibW9kdWxlIiwiZXhwb3J0cyIsImRlZmluZSIsImFtZCIsInVuZGVmaW5lZCIsImNyZWF0ZUVsIiwidGFnIiwicHJvcCIsIm4iLCJjcmVhdGVFbGVtZW50IiwiaW5zIiwicGFyZW50IiwiaSIsImFyZ3VtZW50cyIsImFwcGVuZENoaWxkIiwiYWRkQW5pbWF0aW9uIiwiYWxwaGEiLCJuYW1lIiwiam9pbiIsInN0YXJ0IiwieiIsIk1hdGgiLCJtYXgiLCJwcmVmaXgiLCJ1c2VDc3NBbmltYXRpb25zIiwic3Vic3RyaW5nIiwiaW5kZXhPZiIsInRvTG93ZXJDYXNlIiwicHJlIiwiYW5pbWF0aW9ucyIsInNoZWV0IiwiaW5zZXJ0UnVsZSIsImNzc1J1bGVzIiwidmVuZG9yIiwicHAiLCJzdHlsZSIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJwcmVmaXhlcyIsImNzcyIsIm1lcmdlIiwiZGVmIiwiZ2V0Q29sb3IiLCJpZHgiLCJvIiwidGhpcyIsImRlZmF1bHRzIiwic3RvcCIsInNlbGYiLCJpbnNlcnRCZWZvcmUiLCJmaXJzdENoaWxkIiwic2V0QXR0cmlidXRlIiwiZiIsIm9zdGVwIiwiYXN0ZXAiLCJhbmltIiwiaiIsInRpbWVvdXQiLCJzZXRUaW1lb3V0IiwiY2xlYXJUaW1lb3V0IiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwiZmlsbCIsImhlaWdodCIsImJhY2tncm91bmQiLCJib3hTaGFkb3ciLCJ0cmFuc2Zvcm1PcmlnaW4iLCJ0cmFuc2Zvcm0iLCJib3JkZXJSYWRpdXMiLCJzZWciLCJhbmltYXRpb24iLCJjaGlsZE5vZGVzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJzdHlsZVNoZWV0IiwicHJvYmUiLCJiZWhhdmlvciIsImFkaiIsInZtbCIsImF0dHIiLCJhZGRSdWxlIiwiZ3JwIiwiY29vcmRzaXplIiwiY29vcmRvcmlnaW4iLCJyIiwiZHgiLCJmaWx0ZXIiLCJnIiwicm90YXRpb24iLCJhcmNzaXplIiwibWFyZ2luIiwiYyIsImluaXRWTUwiXSwibWFwcGluZ3MiOiJBQUFBLGFBb0NBLFNBQUFBLFdBQUFDLEVBQUFDLEdBRUEsSUFBQUMsRUFBQSxJQUFBRCxF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LElBYUEsR0FBQTdDLEVBQUE3RCxPQUFBLElBQUE0QixFQUFBLEVBQUFBLEdBQUFpQyxFQUFBN0UsTUFBQTRDLElBQ0EwRCxFQUFBMUQsR0FBQSxFQUFBLHVGQUdBLElBQUFBLEVBQUEsRUFBQUEsR0FBQWlDLEVBQUE3RSxNQUFBNEMsSUFDQTBELEVBQUExRCxHQUNBLE9BQUFGLEVBQUFuQixFQUFBZ0csSUFHQWxHLEVBQUFRLFVBQUF2QixRQUFBLFNBQUFpQixFQUFBcUIsRUFBQXBFLEVBQUFxRyxHQUNBLElBQUE4QyxFQUFBcEcsRUFBQTRELFdBQ0FOLEVBQUFBLEVBQUE3RCxRQUFBNkQsRUFBQTdFLE9BQUEsRUFDQTJILEdBQUEvRSxFQUFBaUMsRUFBQThDLEVBQUFuQixXQUFBOUgsU0FDQWlKLEdBQUFBLEdBQUFBLEVBQUFBLEVBQUFuQixXQUFBNUQsRUFBQWlDLEtBQUE4QyxFQUFBeEMsYUFBQXdDLEVBQUF4QyxjQUNBd0MsRUFBQXJILFFBQUE5QixJQWNBb0osR0FBQXBFLEVBQUFTLEVBQUEwQyxFQUFBLGFBR0EsT0FBQXRGIiwiZmlsZSI6ImZvcm0ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4vKiBcbkZPUiBUSEUgUFVSUE9TRVMgT0YgVEhJUyBBU1NJR05NRU5ULCBwbGVhc2UgY29uc2lkZXIgdGhlIFxuQVBJIGxpbmtlZCBhYm92ZSB0byBiZSBhIFwiYmxhY2tib3hcIiBBUEkgd2l0aCB0aGUgXG5mb2xsb3dpbmcgQ1JVRCBiZWhhdmlvcjpcblxuICAgIENyZWF0ZSBib29raW5nIHJlY29yZDpcbiAgICAtIEhUVFAgcmVxdWVzdDogICdQT1NUIC9hcGkvY3JlYXRlJ1xuICAgICAgICBwYXJhbXM6IGZvcm0gZGF0YSBhcyBKU09OIG9iamVjdFxuICAgIC0gUmVzcG9uc2U6IFxuICAgICAgICB7ICdtZXNzYWdlJzogPHN1Y2Nlc3MvZmFpbD4sICdkYXRhJzogPG5ld19kYXRhPiB9XG5cbiAgICBSZXRyaWV2ZSBib29raW5nIHJlY29yZDpcbiAgICAtIEhUVFAgcmVxdWVzdDogICdHRVQgL2FwaS9ib29raW5nLzxib29rX2lkPicgXG4gICAgICAgIHBhcmFtczogPGJvb2tfaWQ+LCB0aGUgSUQgb2YgdGhlIHJlY29yZCB0byBzZWFyY2ggZm9yXG4gICAgLSBSZXNwb25zZSAoSlNPTik6XG4gICAgICAgIHsgJ21lc3NhZ2UnOiA8c3VjY2Vzcy9mYWlsPiwgJ2RhdGEnOiA8Zm91bmRfZGF0YT4gfVxuXG4gICAgVXBkYXRlIGJvb2tpbmcgcmVjb3JkOlxuICAgIC0gSFRUUCByZXF1ZXN0OiAgJ1BVVCAvYXBpL2Jvb2tpbmcvPGJvb2tfaWQ+J1xuICAgICAgICBwYXJhbXM6IGZvcm0gZGF0YSBhcyBKU09OIG9iamVjdFxuICAgIC0gUmVzcG9uc2U6IFxuICAgICAgICB7ICdtZXNzYWdlJzogPHN1Y2Nlc3MvZmFpbD4sICdkYXRhJzogPG5ld19kYXRhPiB9XG5cbiAgICBEZWxldGUgYm9va2luZyByZWNvcmQ6XG4gICAgLSBIVFRQIHJlcXVlc3Q6ICAnREVMRVRFIC9hcGkvYm9va2luZy88Ym9va19pZD4nIFxuICAgICAgICBwYXJhbXM6IDxib29rX2lkPiwgdGhlIElEIG9mIHRoZSByZWNvcmQgdG8gYmUgZGVsZXRlZFxuICAgIC0gUmVzcG9uc2UgKEpTT04pOlxuICAgICAgICB7ICdtZXNzYWdlJzogPHN1Y2Nlc3MvZmFpbD4gfVxuKi9cblxuLy8gYXNzaWdubWVudCBjb2RlIGJlZ2lucyBoZXJlXG52YXIgYXBpU3RyaW5nID0gJ2h0dHBzOi8vY29tNjAxLWFzc2lnbjEuaGVyb2t1YXBwLmNvbS9hcGknO1xuXG4vLyBBSkFYIGZvciBjcmVhdGluZyBhbmQgdXBkYXRpbmcgYm9va2luZ3NcbmZ1bmN0aW9uIHN1Ym1pdEZvcm0oYm9va2luZywgb2xkSWQpIHtcbiAgICAvLyBmbGFnIGZvciB1cGRhdGluZyBvciBjcmVhdGluZ1xuICAgIHZhciB1cGRhdGVGbGFnID0gb2xkSWQgPT0gXCJcIiA/IGZhbHNlIDogdHJ1ZTtcbiAgICBjb25zb2xlLmxvZygndXBkYXRlPyAnICsgdXBkYXRlRmxhZyk7XG4gICAgdmFyIHBvc3REYXRhID0ge1xuICAgICAgICAnZmlyc3QnOiBib29raW5nLmZpcnN0LFxuICAgICAgICAnbGFzdCc6IGJvb2tpbmcubGFzdCxcbiAgICAgICAgJ2VtYWlsJzogYm9va2luZy5lbWFpbFxuICAgIH07XG5cbiAgICB2YXIgcXVlcnkgPSAnJztcbiAgICBzaG93U3Bpbm5lcigpO1xuICAgIGlmICh1cGRhdGVGbGFnKSB7XG4gICAgICAgIC8vIHVwZGF0ZSBleGlzdGluZyByZWNvcmRcbiAgICAgICAgcXVlcnkgPSBhcGlTdHJpbmcgKyAnL2Jvb2tpbmcvJyArIG9sZElkO1xuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiBxdWVyeSxcbiAgICAgICAgICAgIHR5cGU6ICdQVVQnLFxuICAgICAgICAgICAgZGF0YTogcG9zdERhdGEsXG4gICAgICAgICAgICBzdWNjZXNzOiBoYW5kbGVFZGl0U3VjY2Vzc1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBjcmVhdGUgbmV3IGJvb2tpbmcgcmVjb3JkXG4gICAgICAgIHF1ZXJ5ID0gYXBpU3RyaW5nICsgJy9jcmVhdGUnO1xuICAgICAgICAkLnBvc3QocXVlcnksIHBvc3REYXRhLCBoYW5kbGVFZGl0U3VjY2Vzcyk7XG4gICAgfVxuICAgIGhpZGVTcGlubmVyKCk7XG4gICAgLy8gREVCVUc6IHByaW50IEFKQVggcXVlcnlcbiAgICAvL2NvbnNvbGUubG9nKCdxdWVyeWluZzogJXMnLCBxdWVyeSk7XG59XG5cbi8vIGhhbmRsZSBBSkFYIENSRUFURSAmIFVQREFURSBzdWNjZXNzXG5mdW5jdGlvbiBoYW5kbGVFZGl0U3VjY2VzcyhyZXN1bHQsIHN0YXR1cywgcmVzcCkge1xuICAgIC8vIFRPRE86IGNoYW5nZSB0aGlzIHRvIGRpc3BsYXkgYmV0dGVyXG4gICAgLy8gREVCVUc6IHByaW50IEFKQVggcmVzdWx0IHN0YXR1cyBhbmQgZGF0YVxuICAgIGNvbnNvbGUubG9nKHJlc3VsdCwgc3RhdHVzLCByZXNwLnN0YXR1c1RleHQsIHJlc3Auc3RhdHVzKTtcbiAgICBpZiAocmVzcC5zdGF0dXMgPT0gMjAxKSB7XG4gICAgICAgIC8vIHByb2Nlc3Mgc3VjY2VzcyBwYWdlXG4gICAgICAgICQoJy5zdWNjZXNzLXBhZ2UgPiAuc2VjdGlvbi1oZWFkZXIgPiBoMycpLnRleHQoJ1RoYW5rIHlvdSEnKTtcbiAgICAgICAgJCgnI2Jvb2tlZC1pZCcpLnRleHQoJ1lvdXIgYm9va2luZyBJRDogJyArIHJlc3VsdC5kYXRhLmJvb2tfaWQpO1xuICAgICAgICAkKCcjYm9va2VkLW5hbWUnKS50ZXh0KCdSZWdpc3RlcmVkIG5hbWU6ICcgKyByZXN1bHQuZGF0YS5maXJzdCArICcgJyArIHJlc3VsdC5kYXRhLmxhc3QpO1xuICAgICAgICAkKCcjYm9va2VkLWVtYWlsJykudGV4dCgnRW1haWwgYWRkcmVzczogJyArIHJlc3VsdC5kYXRhLmVtYWlsKTtcbiAgICAgICAgJCgnLnN1Y2Nlc3MtcGFnZSA+IC5zZWN0aW9uLXdyYXBwZXIgPiBwJykuc2hvdygpO1xuXG4gICAgICAgIC8vIHNldCBtZXNzYWdlIGlmIHVwZGF0ZVxuICAgICAgICB2YXIgaWQgPSAkKCcjZm91bmQtaWQnKS52YWwoKTtcbiAgICAgICAgaWYgKGlkICE9IFwiXCIpIHtcbiAgICAgICAgICAgICQoJy5zdWNjZXNzLXBhZ2UgPiAuc2VjdGlvbi1oZWFkZXIgPiBwJykudGV4dChcIllvdXIgYWNjb21vZGF0aW9ucyBoYXZlIGJlZW4gdXBkYXRlZCBzdWNjZXNzZnVsbHkuIENoZWNrIG91dCB0aGUgZGV0YWlscyBiZWxvdzpcIik7XG4gICAgICAgICAgICAkKCcjZm91bmQtaWQnKS52YWwoJycpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJCgnLnN1Y2Nlc3MtcGFnZSA+IC5zZWN0aW9uLWhlYWRlciA+IHAnKS50ZXh0KFwiWW91ciBhY2NvbW9kYXRpb25zIGhhdmUgYmVlbiBib29rZWQgc3VjY2Vzc2Z1bGx5LiBDaGVjayBvdXQgdGhlIGRldGFpbHMgYmVsb3c6XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgJCgnLmJvb2tpbmctZm9ybScpLmhpZGUoKTtcbiAgICAgICAgJCgnLnN1Y2Nlc3MtcGFnZScpLnNob3coKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBlcnJvciB0b29sdGlwc1xuICAgICAgICBpZiAoJCgnI2Vycm9ybXNnJykubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICQoJy5ib29raW5nLWZvcm0gLnNlY3Rpb24td3JhcHBlcicpLmFwcGVuZCgnPHAgaWQ9XCJlcnJvcm1zZ1wiPkxvb2tzIGxpa2UgdGhlcmUgd2FzIGFuIGVycm9yLCAlcyAlcyEgVHJ5IGFnYWluLjwvcD4nLCByZXNwLnN0YXR1cywgcmVzcC5zdGF0dXNUZXh0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFRPRE86IG1ha2UgdGhpcyBhbGwgYmV0dGVyXG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8vIEFKQVggZm9yIGNhbmNlbCBib29raW5nXG5mdW5jdGlvbiBjYW5jZWxCb29raW5nKGlkKSB7XG4gICAgdmFyIHF1ZXJ5ID0gYXBpU3RyaW5nICsgJy9ib29raW5nLycgKyBpZDtcbiAgICBzaG93U3Bpbm5lcigpO1xuICAgICQuYWpheCh7XG4gICAgICAgIHVybDogcXVlcnksXG4gICAgICAgIHR5cGU6ICdERUxFVEUnLFxuICAgICAgICBzdWNjZXNzOiBoYW5kbGVEZWxldGVTdWNjZXNzXG4gICAgfSk7aGlkZVNwaW5uZXIoKTtcbn1cblxuLy8gaGFuZGxlIEFKQVggREVMRVRFIHN1Y2Nlc3NcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZVN1Y2Nlc3MoKSB7XG4gICAgLy8gc2V0IHN1Y2Nlc3MgcGFnZSB0ZXh0XG4gICAgdmFyIGlkID0gJCgnI2ZvdW5kLWlkJykudmFsKCk7XG4gICAgJCgnLnN1Y2Nlc3MtcGFnZSA+IC5zZWN0aW9uLWhlYWRlciA+IGgzJykudGV4dCgnQ2FuY2VsbGVkIHJlc2VydmF0aW9uJyk7XG4gICAgJCgnLnN1Y2Nlc3MtcGFnZSA+IC5zZWN0aW9uLXdyYXBwZXIgPiBwJykuaGlkZSgpO1xuICAgICQoJy5zdWNjZXNzLXBhZ2UgPiAuc2VjdGlvbi1oZWFkZXIgPiBwJykudGV4dChcIllvdXIgYm9va2luZyAoI1wiICsgaWQgKyBcIikgaGFzIGJlZW4gY2FuY2VsbGVkLiBXZSdyZSBzb3JyeSB0byBzZWUgeW91IGdvIVwiKTtcblxuICAgIC8vIHNob3cgc3VjY2VzcyBwYWdlXG4gICAgJCgnLmJvb2tpbmctZm9ybScpLmhpZGUoKTtcbiAgICAkKCcuc3VjY2Vzcy1wYWdlJykuc2hvdygpO1xufVxuXG4vLyBBSkFYIGZvciBmaW5kaW5nIGJvb2tpbmdcbmZ1bmN0aW9uIGZpbmRCeVJlZihpZCkge1xuICAgIHZhciBxdWVyeSA9IGFwaVN0cmluZyArICcvYm9va2luZy8nICsgaWQ7XG4gICAgLy8gREVCVUc6IHByaW50IEFKQVggcXVlcnlcbiAgICAvLyBjb25zb2xlLmxvZygncXVlcnlpbmc6ICVzJywgcXVlcnkpO1xuICAgICQuZ2V0SlNPTihxdWVyeSwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAvLyBERUJVRzogcHJpbnQgcmVzdWx0IGRhdGFcbiAgICAgICAgLy8gY29uc29sZS5sb2cocmVzdWx0LCByZXN1bHQuZGF0YSk7XG4gICAgICAgIGlmIChyZXN1bHQuZGF0YSkge1xuICAgICAgICAgICAgJCgnI2ZpcnN0bmFtZScpLnZhbChyZXN1bHQuZGF0YS5maXJzdCk7XG4gICAgICAgICAgICAkKCcjbGFzdG5hbWUnKS52YWwocmVzdWx0LmRhdGEubGFzdCk7XG4gICAgICAgICAgICAkKCcjZW1haWwnKS52YWwocmVzdWx0LmRhdGEuZW1haWwpO1xuICAgICAgICAgICAgJCgnI2ZvdW5kLWlkJykudmFsKHJlc3VsdC5kYXRhLmJvb2tfaWQpO1xuXG4gICAgICAgICAgICAvLyBjaGFuZ2UgaGVhZGVyIHRleHQgYW5kIGJ1dHRvbiB0ZXh0XG4gICAgICAgICAgICAkKCcuYm9va2luZy1mb3JtID4gLnNlY3Rpb24taGVhZGVyID4gaDMnKS50ZXh0KCdVcGRhdGUgeW91ciBib29raW5nJyk7XG4gICAgICAgICAgICAkKCcuYm9va2luZy1mb3JtID4gLnNlY3Rpb24taGVhZGVyID4gcCcpLnRleHQoJ1dlIGZvdW5kIHlvdXIgYm9va2luZyByZWNvcmQsICcgKyByZXN1bHQuZGF0YS5maXJzdCArICcuIEZlZWwgZnJlZSB0byBjaGFuZ2UgYW55IG9mIHRoZSBmaWVsZHMgYmVsb3cgaWYgeW91IG5lZWQgdG8gdXBkYXRlIGl0LicpO1xuICAgICAgICAgICAgJCgnI3N1Ym1pdC1idG4nKS50ZXh0KCdVcGRhdGUgYm9va2luZycpO1xuICAgICAgICAgICAgJCgnLmJvb2tpbmctZm9ybSA+IC5zZWN0aW9uLWZvb3RlciA+IHAnKS5odG1sKCdXYW50IHRvIHN0YXJ0IG92ZXI/IDxhIGhyZWY9XCIjXCIgY2xhc3M9XCJzZWFyY2gtbGlua1wiPkdvIGJhY2s8L2E+Jyk7XG5cbiAgICAgICAgICAgIC8vIGNhbmNlbCBsaW5rXG4gICAgICAgICAgICAkKCcuY2FuY2VsLWxpbmsnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY2FuY2VsQm9va2luZyhyZXN1bHQuZGF0YS5ib29rX2lkKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKCcuY2FuY2VsLXByb21wdCcpLnNob3coKTtcbiAgICAgICAgICAgICQoJy5ib29raW5nLWZvcm0nKS5zaG93KCk7XG4gICAgICAgICAgICAkKCcuc2VhcmNoLWZvcm0nKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIC8vIHJlLWluaXQgc2VhcmNoIGxpbmsgZXZlbnQgaGFuZGxlclxuICAgICAgICAgICAgJCgnLnNlYXJjaC1saW5rJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICQoJy5ib29raW5nLWZvcm0nKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgJCgnLnNlYXJjaC1mb3JtJykuc2hvdygpO1xuICAgICAgICAgICAgfSk7JCgnI3NlYXJjaC1pbnB1dCcpLnZhbCgnJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBVc2UgdG9vbHRpcCBoZXJlXG4gICAgICAgICAgICAvLyBERUJVRzogbG9nIGlmIElEIG5vdCBmb3VuZFxuICAgICAgICAgICAgY29uc29sZS5sb2coJ25vdCBmb3VuZCEnKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG4vLyBBSkFYIGxvYWRpbmcgc3Bpbm5lcnMsIHBvd2VyZWQgYnkgc3Bpbi5qc1xuZnVuY3Rpb24gc2hvd1NwaW5uZXIoKSB7XG4gICAgY29uc29sZS5pbmZvKCdzaG93aW5nIHNwaW5uZXIuLi4nKTtcbiAgICAkKCcuc3Bpbm5lcicpLnNob3coKTtcbn1cblxuZnVuY3Rpb24gaGlkZVNwaW5uZXIoKSB7XG4gICAgY29uc29sZS5pbmZvKCdoaWRpbmcgc3Bpbm5lci4uLicpO1xuICAgICQoJy5zcGlubmVyJykuaGlkZSgpO1xufVxuXG4vLyBET00gbWFuaXB1bGF0aW9uIGFmdGVyIGRvY3VtZW50IGlzIHJlYWR5XG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgLy8gaGlkZSBib29raW5nIGZvcm0gYW5kIHN1Y2Nlc3MgcGFnZVxuICAgICQoJy5ib29raW5nLWZvcm0nKS5oaWRlKCk7XG4gICAgJCgnLmNhbmNlbC1wcm9tcHQnKS5oaWRlKCk7XG4gICAgJCgnLnN1Y2Nlc3MtcGFnZScpLmhpZGUoKTtcbiAgICAkKCcuc3Bpbm5lcicpLmhpZGUoKTtcblxuICAgIC8vIHN3aXRjaCB2aWV3IHRvIHNlYXJjaFxuICAgICQoJy5zZWFyY2gtbGluaycpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJCgnLmJvb2tpbmctZm9ybScpLmhpZGUoKTtcbiAgICAgICAgJCgnLnNlYXJjaC1mb3JtJykuc2hvdygpO1xuICAgIH0pO1xuXG4gICAgLy8gc3dpdGNoIHZpZXcgdG8gYm9va2luZyBmb3JtXG4gICAgJCgnLmJvb2tpbmctbGluaycpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gY2xlYXIgZm9ybXNcbiAgICAgICAgJCgnI2ZpcnN0bmFtZScpLnZhbCgnJyk7XG4gICAgICAgICQoJyNsYXN0bmFtZScpLnZhbCgnJyk7XG4gICAgICAgICQoJyNlbWFpbCcpLnZhbCgnJyk7XG4gICAgICAgICQoJyNzZWFyY2gtaW5wdXQnKS52YWwoJycpO1xuICAgICAgICAkKCcjZm91bmQtaWQnKS52YWwoJycpO1xuICAgICAgICAkKCcuY2FuY2VsLXByb21wdCcpLmhpZGUoKTtcblxuICAgICAgICAvLyByZXNldCB0ZXh0XG4gICAgICAgICQoJyNzdWJtaXQtYnRuJykudGV4dCgnUmVzZXJ2ZSBub3cnKTtcbiAgICAgICAgJCgnLmJvb2tpbmctZm9ybSA+IC5zZWN0aW9uLWhlYWRlciA+IGgzJykudGV4dCgnQ3JlYXRlIGEgbmV3IGJvb2tpbmcnKTtcbiAgICAgICAgJCgnLmJvb2tpbmctZm9ybSA+IC5zZWN0aW9uLWhlYWRlciA+IHAnKS50ZXh0KCdGaWxsIG91dCB0aGUgZmllbGRzIGJlbG93IHRvIGJvb2sgYSBuZXcgYWNjb21vZGF0aW9uJyk7XG4gICAgICAgICQoJy5ib29raW5nLWZvcm0gPiAuc2VjdGlvbi1mb290ZXIgPiBwJykuaHRtbCgnQWxyZWFkeSBoYXZlIGFjY29tb2RhdGlvbnM/IDxhIGhyZWY9XCIjXCIgY2xhc3M9XCJzZWFyY2gtbGlua1wiPkxvb2sgdXAgeW91ciBib29raW5nIGhlcmUhPC9hPicpO1xuICAgICAgICAkKCcuc2VhcmNoLWxpbmsnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCcuYm9va2luZy1mb3JtJykuaGlkZSgpO1xuICAgICAgICAgICAgJCgnLnNlYXJjaC1mb3JtJykuc2hvdygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKCcuYm9va2luZy1mb3JtJykuc2hvdygpO1xuICAgICAgICAkKCcuc2VhcmNoLWZvcm0nKS5oaWRlKCk7XG4gICAgICAgICQoJy5zdWNjZXNzLXBhZ2UnKS5oaWRlKCk7XG4gICAgfSk7XG5cbiAgICAvLyBhZGQgY2xpY2sgaGFuZGxlciBmb3Igc3VibWl0IGJ1dHRvblxuICAgIHZhciBzdWJtaXRCdG4gPSAkKCcjc3VibWl0LWJ0bicpO1xuICAgIHN1Ym1pdEJ0bi5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIGdldCBmb3JtIHZhbHVlcyBhbmQgc2F2ZSB0byBvYmplY3RcbiAgICAgICAgdmFyIGZpcnN0TmFtZSA9ICQoJyNmaXJzdG5hbWUnKS52YWwoKTtcbiAgICAgICAgdmFyIGxhc3ROYW1lID0gJCgnI2xhc3RuYW1lJykudmFsKCk7XG4gICAgICAgIHZhciBlbWFpbCA9ICQoJyNlbWFpbCcpLnZhbCgpO1xuICAgICAgICB2YXIgbmV3Qm9va2luZyA9IHtcbiAgICAgICAgICAgICdmaXJzdCc6IGZpcnN0TmFtZSxcbiAgICAgICAgICAgICdsYXN0JzogbGFzdE5hbWUsXG4gICAgICAgICAgICAnZW1haWwnOiBlbWFpbFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHZhbGlkYXRlIGZpZWxkc1xuICAgICAgICBpZiAoIWZpcnN0TmFtZSB8fCAhbGFzdE5hbWUgfHwgIWVtYWlsKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBzaG93IHRvb2x0aXAsIGNvbnNvbGUubG9nIGZvciBub3dcbiAgICAgICAgICAgIC8vIFRPRE86IGJldHRlciBlbWFpbCBjbGllbnQgdmFsaWRhdGlvblxuICAgICAgICAgICAgLy8gREVCVUc6IGxvZyBpZiBmb3JtIGluY29tcGxldGVcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZm9ybSB2YWx1ZXMgbWlzc2luZyFcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBzdWJtaXQgZm9ybSB3aXRoIG9sZCBJRCwgaWYgZm91bmRcbiAgICAgICAgICAgIHZhciBvbGRJZCA9ICQoJyNmb3VuZC1pZCcpLnZhbCgpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2Jvb2tpbmc6ICcsIG5ld0Jvb2tpbmcsIG9sZElkKTtcbiAgICAgICAgICAgIHN1Ym1pdEZvcm0obmV3Qm9va2luZywgb2xkSWQpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBhZGQgY2xpY2sgaGFuZGxlciBmb3Igc2VhcmNoIGJ1dHRvblxuICAgIHZhciBzZWFyY2hCdG4gPSAkKCcjc2VhcmNoLWJ0bicpO1xuICAgIHNlYXJjaEJ0bi5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIFRPRE86IHJlcGxhY2UgdGhpcyB3aXRoIHRvb2x0aXBcbiAgICAgICAgLy8gREVCVUc6IGxvZyBpZiBmb3JtIGluY29tcGxldGVcbiAgICAgICAgdmFyIHNlYXJjaElkID0gJCgnI3NlYXJjaC1pbnB1dCcpLnZhbCgpO1xuICAgICAgICBpZiAoIXNlYXJjaElkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInNlYXJjaCBJRCBtaXNzaW5nIVwiLCBzZWFyY2hJZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzaG93U3Bpbm5lcigpO2ZpbmRCeVJlZihzZWFyY2hJZCk7aGlkZVNwaW5uZXIoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gaGFuZGxlIGVudGVyIGtleSBvbiBzZWFyY2hcbiAgICB2YXIgc2VhcmNoSW5wID0gJCgnI3NlYXJjaC1pbnB1dCcpO1xuICAgIHNlYXJjaElucC5rZXlwcmVzcyhmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoZS5rZXlDb2RlID09IDEzKSB7XG4gICAgICAgICAgICBzZWFyY2hCdG4uY2xpY2soKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gaGFuZGxlIGVudGVyIGtleSBvbiBmb3JtXG4gICAgdmFyIGZvcm1JbnAgPSAkKCcuYm9va2luZy1mb3JtID4gLnNlY3Rpb24td3JhcHBlciA+IGlucHV0Jyk7XG4gICAgZm9ybUlucC5rZXlwcmVzcyhmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoZS5rZXlDb2RlID09IDEzKSB7XG4gICAgICAgICAgICBzdWJtaXRCdG4uY2xpY2soKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gc2V0IHVwIEFKQVggc3Bpbm5lciBlbGVtZW50XG4gICAgdmFyIG9wdHMgPSB7IGxpbmVzOiA5LCBsZW5ndGg6IDM0LCB3aWR0aDogNiwgcmFkaXVzOiAyNCwgc2NhbGU6IDEsIGNvcm5lcnM6IDAuMiwgY29sb3I6ICcjMDAwJywgb3BhY2l0eTogMC4yNSwgcm90YXRlOiAwLCBkaXJlY3Rpb246IDEsIHNwZWVkOiAwLjgsIHRyYWlsOiAyNSwgZnBzOiAyMCwgekluZGV4OiAyZTksIGNsYXNzTmFtZTogJ3NwaW5uZXInLCB0b3A6ICc1MCUnLCBsZWZ0OiAnNTAlJywgc2hhZG93OiBmYWxzZSwgaHdhY2NlbDogdHJ1ZSwgcG9zaXRpb246ICdhYnNvbHV0ZScgfTtcbiAgICB2YXIgdGFyZ2V0ID0gJCgnLmNvbnRhaW5lcicpO1xuICAgIHZhciBzID0gbmV3IFNwaW5uZXIob3B0cykuc3BpbigpO1xuICAgIHRhcmdldC5hcHBlbmQocy5lbCk7XG4gICAgaGlkZVNwaW5uZXIoKTtcbn0pOyIsIid1c2Ugc3RyaWN0JztcblxudmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9O1xuXG4vKipcbiAqIENvcHlyaWdodCAoYykgMjAxMS0yMDE0IEZlbGl4IEduYXNzXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbiAqIGh0dHA6Ly9zcGluLmpzLm9yZy9cbiAqXG4gKiBFeGFtcGxlOlxuICAgIHZhciBvcHRzID0ge1xuICAgICAgbGluZXM6IDEyICAgICAgICAgICAgIC8vIFRoZSBudW1iZXIgb2YgbGluZXMgdG8gZHJhd1xuICAgICwgbGVuZ3RoOiA3ICAgICAgICAgICAgIC8vIFRoZSBsZW5ndGggb2YgZWFjaCBsaW5lXG4gICAgLCB3aWR0aDogNSAgICAgICAgICAgICAgLy8gVGhlIGxpbmUgdGhpY2tuZXNzXG4gICAgLCByYWRpdXM6IDEwICAgICAgICAgICAgLy8gVGhlIHJhZGl1cyBvZiB0aGUgaW5uZXIgY2lyY2xlXG4gICAgLCBzY2FsZTogMS4wICAgICAgICAgICAgLy8gU2NhbGVzIG92ZXJhbGwgc2l6ZSBvZiB0aGUgc3Bpbm5lclxuICAgICwgY29ybmVyczogMSAgICAgICAgICAgIC8vIFJvdW5kbmVzcyAoMC4uMSlcbiAgICAsIGNvbG9yOiAnIzAwMCcgICAgICAgICAvLyAjcmdiIG9yICNycmdnYmJcbiAgICAsIG9wYWNpdHk6IDEvNCAgICAgICAgICAvLyBPcGFjaXR5IG9mIHRoZSBsaW5lc1xuICAgICwgcm90YXRlOiAwICAgICAgICAgICAgIC8vIFJvdGF0aW9uIG9mZnNldFxuICAgICwgZGlyZWN0aW9uOiAxICAgICAgICAgIC8vIDE6IGNsb2Nrd2lzZSwgLTE6IGNvdW50ZXJjbG9ja3dpc2VcbiAgICAsIHNwZWVkOiAxICAgICAgICAgICAgICAvLyBSb3VuZHMgcGVyIHNlY29uZFxuICAgICwgdHJhaWw6IDEwMCAgICAgICAgICAgIC8vIEFmdGVyZ2xvdyBwZXJjZW50YWdlXG4gICAgLCBmcHM6IDIwICAgICAgICAgICAgICAgLy8gRnJhbWVzIHBlciBzZWNvbmQgd2hlbiB1c2luZyBzZXRUaW1lb3V0KClcbiAgICAsIHpJbmRleDogMmU5ICAgICAgICAgICAvLyBVc2UgYSBoaWdoIHotaW5kZXggYnkgZGVmYXVsdFxuICAgICwgY2xhc3NOYW1lOiAnc3Bpbm5lcicgIC8vIENTUyBjbGFzcyB0byBhc3NpZ24gdG8gdGhlIGVsZW1lbnRcbiAgICAsIHRvcDogJzUwJScgICAgICAgICAgICAvLyBjZW50ZXIgdmVydGljYWxseVxuICAgICwgbGVmdDogJzUwJScgICAgICAgICAgIC8vIGNlbnRlciBob3Jpem9udGFsbHlcbiAgICAsIHNoYWRvdzogZmFsc2UgICAgICAgICAvLyBXaGV0aGVyIHRvIHJlbmRlciBhIHNoYWRvd1xuICAgICwgaHdhY2NlbDogZmFsc2UgICAgICAgIC8vIFdoZXRoZXIgdG8gdXNlIGhhcmR3YXJlIGFjY2VsZXJhdGlvbiAobWlnaHQgYmUgYnVnZ3kpXG4gICAgLCBwb3NpdGlvbjogJ2Fic29sdXRlJyAgLy8gRWxlbWVudCBwb3NpdGlvbmluZ1xuICAgIH1cbiAgICB2YXIgdGFyZ2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbycpXG4gICAgdmFyIHNwaW5uZXIgPSBuZXcgU3Bpbm5lcihvcHRzKS5zcGluKHRhcmdldClcbiAqL1xuOyhmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkge1xuXG4gIC8qIENvbW1vbkpTICovXG4gIGlmICgodHlwZW9mIG1vZHVsZSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YobW9kdWxlKSkgPT0gJ29iamVjdCcgJiYgbW9kdWxlLmV4cG9ydHMpIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXG4gIC8qIEFNRCBtb2R1bGUgKi9cbiAgZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIGRlZmluZShmYWN0b3J5KTtcblxuICAgIC8qIEJyb3dzZXIgZ2xvYmFsICovXG4gICAgZWxzZSByb290LlNwaW5uZXIgPSBmYWN0b3J5KCk7XG59KSh1bmRlZmluZWQsIGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIHByZWZpeGVzID0gWyd3ZWJraXQnLCAnTW96JywgJ21zJywgJ08nXSAvKiBWZW5kb3IgcHJlZml4ZXMgKi9cbiAgLFxuICAgICAgYW5pbWF0aW9ucyA9IHt9IC8qIEFuaW1hdGlvbiBydWxlcyBrZXllZCBieSB0aGVpciBuYW1lICovXG4gICxcbiAgICAgIHVzZUNzc0FuaW1hdGlvbnMgLyogV2hldGhlciB0byB1c2UgQ1NTIGFuaW1hdGlvbnMgb3Igc2V0VGltZW91dCAqL1xuICAsXG4gICAgICBzaGVldDsgLyogQSBzdHlsZXNoZWV0IHRvIGhvbGQgdGhlIEBrZXlmcmFtZSBvciBWTUwgcnVsZXMuICovXG5cbiAgLyoqXG4gICAqIFV0aWxpdHkgZnVuY3Rpb24gdG8gY3JlYXRlIGVsZW1lbnRzLiBJZiBubyB0YWcgbmFtZSBpcyBnaXZlbixcbiAgICogYSBESVYgaXMgY3JlYXRlZC4gT3B0aW9uYWxseSBwcm9wZXJ0aWVzIGNhbiBiZSBwYXNzZWQuXG4gICAqL1xuICBmdW5jdGlvbiBjcmVhdGVFbCh0YWcsIHByb3ApIHtcbiAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyB8fCAnZGl2JyksXG4gICAgICAgIG47XG5cbiAgICBmb3IgKG4gaW4gcHJvcCkge1xuICAgICAgZWxbbl0gPSBwcm9wW25dO1xuICAgIH1yZXR1cm4gZWw7XG4gIH1cblxuICAvKipcbiAgICogQXBwZW5kcyBjaGlsZHJlbiBhbmQgcmV0dXJucyB0aGUgcGFyZW50LlxuICAgKi9cbiAgZnVuY3Rpb24gaW5zKHBhcmVudCAvKiBjaGlsZDEsIGNoaWxkMiwgLi4uKi8pIHtcbiAgICBmb3IgKHZhciBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgIHBhcmVudC5hcHBlbmRDaGlsZChhcmd1bWVudHNbaV0pO1xuICAgIH1cblxuICAgIHJldHVybiBwYXJlbnQ7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBvcGFjaXR5IGtleWZyYW1lIGFuaW1hdGlvbiBydWxlIGFuZCByZXR1cm5zIGl0cyBuYW1lLlxuICAgKiBTaW5jZSBtb3N0IG1vYmlsZSBXZWJraXRzIGhhdmUgdGltaW5nIGlzc3VlcyB3aXRoIGFuaW1hdGlvbi1kZWxheSxcbiAgICogd2UgY3JlYXRlIHNlcGFyYXRlIHJ1bGVzIGZvciBlYWNoIGxpbmUvc2VnbWVudC5cbiAgICovXG4gIGZ1bmN0aW9uIGFkZEFuaW1hdGlvbihhbHBoYSwgdHJhaWwsIGksIGxpbmVzKSB7XG4gICAgdmFyIG5hbWUgPSBbJ29wYWNpdHknLCB0cmFpbCwgfn4oYWxwaGEgKiAxMDApLCBpLCBsaW5lc10uam9pbignLScpLFxuICAgICAgICBzdGFydCA9IDAuMDEgKyBpIC8gbGluZXMgKiAxMDAsXG4gICAgICAgIHogPSBNYXRoLm1heCgxIC0gKDEgLSBhbHBoYSkgLyB0cmFpbCAqICgxMDAgLSBzdGFydCksIGFscGhhKSxcbiAgICAgICAgcHJlZml4ID0gdXNlQ3NzQW5pbWF0aW9ucy5zdWJzdHJpbmcoMCwgdXNlQ3NzQW5pbWF0aW9ucy5pbmRleE9mKCdBbmltYXRpb24nKSkudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgcHJlID0gcHJlZml4ICYmICctJyArIHByZWZpeCArICctJyB8fCAnJztcblxuICAgIGlmICghYW5pbWF0aW9uc1tuYW1lXSkge1xuICAgICAgc2hlZXQuaW5zZXJ0UnVsZSgnQCcgKyBwcmUgKyAna2V5ZnJhbWVzICcgKyBuYW1lICsgJ3snICsgJzAle29wYWNpdHk6JyArIHogKyAnfScgKyBzdGFydCArICcle29wYWNpdHk6JyArIGFscGhhICsgJ30nICsgKHN0YXJ0ICsgMC4wMSkgKyAnJXtvcGFjaXR5OjF9JyArIChzdGFydCArIHRyYWlsKSAlIDEwMCArICcle29wYWNpdHk6JyArIGFscGhhICsgJ30nICsgJzEwMCV7b3BhY2l0eTonICsgeiArICd9JyArICd9Jywgc2hlZXQuY3NzUnVsZXMubGVuZ3RoKTtcblxuICAgICAgYW5pbWF0aW9uc1tuYW1lXSA9IDE7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5hbWU7XG4gIH1cblxuICAvKipcbiAgICogVHJpZXMgdmFyaW91cyB2ZW5kb3IgcHJlZml4ZXMgYW5kIHJldHVybnMgdGhlIGZpcnN0IHN1cHBvcnRlZCBwcm9wZXJ0eS5cbiAgICovXG4gIGZ1bmN0aW9uIHZlbmRvcihlbCwgcHJvcCkge1xuICAgIHZhciBzID0gZWwuc3R5bGUsXG4gICAgICAgIHBwLFxuICAgICAgICBpO1xuXG4gICAgcHJvcCA9IHByb3AuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBwcm9wLnNsaWNlKDEpO1xuICAgIGlmIChzW3Byb3BdICE9PSB1bmRlZmluZWQpIHJldHVybiBwcm9wO1xuICAgIGZvciAoaSA9IDA7IGkgPCBwcmVmaXhlcy5sZW5ndGg7IGkrKykge1xuICAgICAgcHAgPSBwcmVmaXhlc1tpXSArIHByb3A7XG4gICAgICBpZiAoc1twcF0gIT09IHVuZGVmaW5lZCkgcmV0dXJuIHBwO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIG11bHRpcGxlIHN0eWxlIHByb3BlcnRpZXMgYXQgb25jZS5cbiAgICovXG4gIGZ1bmN0aW9uIGNzcyhlbCwgcHJvcCkge1xuICAgIGZvciAodmFyIG4gaW4gcHJvcCkge1xuICAgICAgZWwuc3R5bGVbdmVuZG9yKGVsLCBuKSB8fCBuXSA9IHByb3Bbbl07XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbGxzIGluIGRlZmF1bHQgdmFsdWVzLlxuICAgKi9cbiAgZnVuY3Rpb24gbWVyZ2Uob2JqKSB7XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBkZWYgPSBhcmd1bWVudHNbaV07XG4gICAgICBmb3IgKHZhciBuIGluIGRlZikge1xuICAgICAgICBpZiAob2JqW25dID09PSB1bmRlZmluZWQpIG9ialtuXSA9IGRlZltuXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG9iajtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBsaW5lIGNvbG9yIGZyb20gdGhlIGdpdmVuIHN0cmluZyBvciBhcnJheS5cbiAgICovXG4gIGZ1bmN0aW9uIGdldENvbG9yKGNvbG9yLCBpZHgpIHtcbiAgICByZXR1cm4gdHlwZW9mIGNvbG9yID09ICdzdHJpbmcnID8gY29sb3IgOiBjb2xvcltpZHggJSBjb2xvci5sZW5ndGhdO1xuICB9XG5cbiAgLy8gQnVpbHQtaW4gZGVmYXVsdHNcblxuICB2YXIgZGVmYXVsdHMgPSB7XG4gICAgbGluZXM6IDEyIC8vIFRoZSBudW1iZXIgb2YgbGluZXMgdG8gZHJhd1xuICAgICwgbGVuZ3RoOiA3IC8vIFRoZSBsZW5ndGggb2YgZWFjaCBsaW5lXG4gICAgLCB3aWR0aDogNSAvLyBUaGUgbGluZSB0aGlja25lc3NcbiAgICAsIHJhZGl1czogMTAgLy8gVGhlIHJhZGl1cyBvZiB0aGUgaW5uZXIgY2lyY2xlXG4gICAgLCBzY2FsZTogMS4wIC8vIFNjYWxlcyBvdmVyYWxsIHNpemUgb2YgdGhlIHNwaW5uZXJcbiAgICAsIGNvcm5lcnM6IDEgLy8gUm91bmRuZXNzICgwLi4xKVxuICAgICwgY29sb3I6ICcjMDAwJyAvLyAjcmdiIG9yICNycmdnYmJcbiAgICAsIG9wYWNpdHk6IDEgLyA0IC8vIE9wYWNpdHkgb2YgdGhlIGxpbmVzXG4gICAgLCByb3RhdGU6IDAgLy8gUm90YXRpb24gb2Zmc2V0XG4gICAgLCBkaXJlY3Rpb246IDEgLy8gMTogY2xvY2t3aXNlLCAtMTogY291bnRlcmNsb2Nrd2lzZVxuICAgICwgc3BlZWQ6IDEgLy8gUm91bmRzIHBlciBzZWNvbmRcbiAgICAsIHRyYWlsOiAxMDAgLy8gQWZ0ZXJnbG93IHBlcmNlbnRhZ2VcbiAgICAsIGZwczogMjAgLy8gRnJhbWVzIHBlciBzZWNvbmQgd2hlbiB1c2luZyBzZXRUaW1lb3V0KClcbiAgICAsIHpJbmRleDogMmU5IC8vIFVzZSBhIGhpZ2ggei1pbmRleCBieSBkZWZhdWx0XG4gICAgLCBjbGFzc05hbWU6ICdzcGlubmVyJyAvLyBDU1MgY2xhc3MgdG8gYXNzaWduIHRvIHRoZSBlbGVtZW50XG4gICAgLCB0b3A6ICc1MCUnIC8vIGNlbnRlciB2ZXJ0aWNhbGx5XG4gICAgLCBsZWZ0OiAnNTAlJyAvLyBjZW50ZXIgaG9yaXpvbnRhbGx5XG4gICAgLCBzaGFkb3c6IGZhbHNlIC8vIFdoZXRoZXIgdG8gcmVuZGVyIGEgc2hhZG93XG4gICAgLCBod2FjY2VsOiBmYWxzZSAvLyBXaGV0aGVyIHRvIHVzZSBoYXJkd2FyZSBhY2NlbGVyYXRpb24gKG1pZ2h0IGJlIGJ1Z2d5KVxuICAgICwgcG9zaXRpb246ICdhYnNvbHV0ZScgLy8gRWxlbWVudCBwb3NpdGlvbmluZ1xuXG5cbiAgICAvKiogVGhlIGNvbnN0cnVjdG9yICovXG4gIH07ZnVuY3Rpb24gU3Bpbm5lcihvKSB7XG4gICAgdGhpcy5vcHRzID0gbWVyZ2UobyB8fCB7fSwgU3Bpbm5lci5kZWZhdWx0cywgZGVmYXVsdHMpO1xuICB9XG5cbiAgLy8gR2xvYmFsIGRlZmF1bHRzIHRoYXQgb3ZlcnJpZGUgdGhlIGJ1aWx0LWluczpcbiAgU3Bpbm5lci5kZWZhdWx0cyA9IHt9O1xuXG4gIG1lcmdlKFNwaW5uZXIucHJvdG90eXBlLCB7XG4gICAgLyoqXG4gICAgICogQWRkcyB0aGUgc3Bpbm5lciB0byB0aGUgZ2l2ZW4gdGFyZ2V0IGVsZW1lbnQuIElmIHRoaXMgaW5zdGFuY2UgaXMgYWxyZWFkeVxuICAgICAqIHNwaW5uaW5nLCBpdCBpcyBhdXRvbWF0aWNhbGx5IHJlbW92ZWQgZnJvbSBpdHMgcHJldmlvdXMgdGFyZ2V0IGIgY2FsbGluZ1xuICAgICAqIHN0b3AoKSBpbnRlcm5hbGx5LlxuICAgICAqL1xuICAgIHNwaW46IGZ1bmN0aW9uIHNwaW4odGFyZ2V0KSB7XG4gICAgICB0aGlzLnN0b3AoKTtcblxuICAgICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICAgIG8gPSBzZWxmLm9wdHMsXG4gICAgICAgICAgZWwgPSBzZWxmLmVsID0gY3JlYXRlRWwobnVsbCwgeyBjbGFzc05hbWU6IG8uY2xhc3NOYW1lIH0pO1xuXG4gICAgICBjc3MoZWwsIHtcbiAgICAgICAgcG9zaXRpb246IG8ucG9zaXRpb24sXG4gICAgICAgIHdpZHRoOiAwLFxuICAgICAgICB6SW5kZXg6IG8uekluZGV4LFxuICAgICAgICBsZWZ0OiBvLmxlZnQsXG4gICAgICAgIHRvcDogby50b3BcbiAgICAgIH0pO1xuXG4gICAgICBpZiAodGFyZ2V0KSB7XG4gICAgICAgIHRhcmdldC5pbnNlcnRCZWZvcmUoZWwsIHRhcmdldC5maXJzdENoaWxkIHx8IG51bGwpO1xuICAgICAgfVxuXG4gICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAncHJvZ3Jlc3NiYXInKTtcbiAgICAgIHNlbGYubGluZXMoZWwsIHNlbGYub3B0cyk7XG5cbiAgICAgIGlmICghdXNlQ3NzQW5pbWF0aW9ucykge1xuICAgICAgICAvLyBObyBDU1MgYW5pbWF0aW9uIHN1cHBvcnQsIHVzZSBzZXRUaW1lb3V0KCkgaW5zdGVhZFxuICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICBzdGFydCA9IChvLmxpbmVzIC0gMSkgKiAoMSAtIG8uZGlyZWN0aW9uKSAvIDIsXG4gICAgICAgICAgICBhbHBoYSxcbiAgICAgICAgICAgIGZwcyA9IG8uZnBzLFxuICAgICAgICAgICAgZiA9IGZwcyAvIG8uc3BlZWQsXG4gICAgICAgICAgICBvc3RlcCA9ICgxIC0gby5vcGFjaXR5KSAvIChmICogby50cmFpbCAvIDEwMCksXG4gICAgICAgICAgICBhc3RlcCA9IGYgLyBvLmxpbmVzOyhmdW5jdGlvbiBhbmltKCkge1xuICAgICAgICAgIGkrKztcbiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG8ubGluZXM7IGorKykge1xuICAgICAgICAgICAgYWxwaGEgPSBNYXRoLm1heCgxIC0gKGkgKyAoby5saW5lcyAtIGopICogYXN0ZXApICUgZiAqIG9zdGVwLCBvLm9wYWNpdHkpO1xuXG4gICAgICAgICAgICBzZWxmLm9wYWNpdHkoZWwsIGogKiBvLmRpcmVjdGlvbiArIHN0YXJ0LCBhbHBoYSwgbyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNlbGYudGltZW91dCA9IHNlbGYuZWwgJiYgc2V0VGltZW91dChhbmltLCB+figxMDAwIC8gZnBzKSk7XG4gICAgICAgIH0pKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gc2VsZjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTdG9wcyBhbmQgcmVtb3ZlcyB0aGUgU3Bpbm5lci5cbiAgICAgKi9cbiAgICAsIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgICB2YXIgZWwgPSB0aGlzLmVsO1xuICAgICAgaWYgKGVsKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpO1xuICAgICAgICBpZiAoZWwucGFyZW50Tm9kZSkgZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7XG4gICAgICAgIHRoaXMuZWwgPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbnRlcm5hbCBtZXRob2QgdGhhdCBkcmF3cyB0aGUgaW5kaXZpZHVhbCBsaW5lcy4gV2lsbCBiZSBvdmVyd3JpdHRlblxuICAgICAqIGluIFZNTCBmYWxsYmFjayBtb2RlIGJlbG93LlxuICAgICAqL1xuICAgICwgbGluZXM6IGZ1bmN0aW9uIGxpbmVzKGVsLCBvKSB7XG4gICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgc3RhcnQgPSAoby5saW5lcyAtIDEpICogKDEgLSBvLmRpcmVjdGlvbikgLyAyLFxuICAgICAgICAgIHNlZztcblxuICAgICAgZnVuY3Rpb24gZmlsbChjb2xvciwgc2hhZG93KSB7XG4gICAgICAgIHJldHVybiBjc3MoY3JlYXRlRWwoKSwge1xuICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgIHdpZHRoOiBvLnNjYWxlICogKG8ubGVuZ3RoICsgby53aWR0aCkgKyAncHgnLFxuICAgICAgICAgIGhlaWdodDogby5zY2FsZSAqIG8ud2lkdGggKyAncHgnLFxuICAgICAgICAgIGJhY2tncm91bmQ6IGNvbG9yLFxuICAgICAgICAgIGJveFNoYWRvdzogc2hhZG93LFxuICAgICAgICAgIHRyYW5zZm9ybU9yaWdpbjogJ2xlZnQnLFxuICAgICAgICAgIHRyYW5zZm9ybTogJ3JvdGF0ZSgnICsgfn4oMzYwIC8gby5saW5lcyAqIGkgKyBvLnJvdGF0ZSkgKyAnZGVnKSB0cmFuc2xhdGUoJyArIG8uc2NhbGUgKiBvLnJhZGl1cyArICdweCcgKyAnLDApJyxcbiAgICAgICAgICBib3JkZXJSYWRpdXM6IChvLmNvcm5lcnMgKiBvLnNjYWxlICogby53aWR0aCA+PiAxKSArICdweCdcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGZvciAoOyBpIDwgby5saW5lczsgaSsrKSB7XG4gICAgICAgIHNlZyA9IGNzcyhjcmVhdGVFbCgpLCB7XG4gICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgICAgdG9wOiAxICsgfihvLnNjYWxlICogby53aWR0aCAvIDIpICsgJ3B4JyxcbiAgICAgICAgICB0cmFuc2Zvcm06IG8uaHdhY2NlbCA/ICd0cmFuc2xhdGUzZCgwLDAsMCknIDogJycsXG4gICAgICAgICAgb3BhY2l0eTogby5vcGFjaXR5LFxuICAgICAgICAgIGFuaW1hdGlvbjogdXNlQ3NzQW5pbWF0aW9ucyAmJiBhZGRBbmltYXRpb24oby5vcGFjaXR5LCBvLnRyYWlsLCBzdGFydCArIGkgKiBvLmRpcmVjdGlvbiwgby5saW5lcykgKyAnICcgKyAxIC8gby5zcGVlZCArICdzIGxpbmVhciBpbmZpbml0ZSdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKG8uc2hhZG93KSBpbnMoc2VnLCBjc3MoZmlsbCgnIzAwMCcsICcwIDAgNHB4ICMwMDAnKSwgeyB0b3A6ICcycHgnIH0pKTtcbiAgICAgICAgaW5zKGVsLCBpbnMoc2VnLCBmaWxsKGdldENvbG9yKG8uY29sb3IsIGkpLCAnMCAwIDFweCByZ2JhKDAsMCwwLC4xKScpKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZWw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgbWV0aG9kIHRoYXQgYWRqdXN0cyB0aGUgb3BhY2l0eSBvZiBhIHNpbmdsZSBsaW5lLlxuICAgICAqIFdpbGwgYmUgb3ZlcndyaXR0ZW4gaW4gVk1MIGZhbGxiYWNrIG1vZGUgYmVsb3cuXG4gICAgICovXG4gICAgLCBvcGFjaXR5OiBmdW5jdGlvbiBvcGFjaXR5KGVsLCBpLCB2YWwpIHtcbiAgICAgIGlmIChpIDwgZWwuY2hpbGROb2Rlcy5sZW5ndGgpIGVsLmNoaWxkTm9kZXNbaV0uc3R5bGUub3BhY2l0eSA9IHZhbDtcbiAgICB9XG5cbiAgfSk7XG5cbiAgZnVuY3Rpb24gaW5pdFZNTCgpIHtcblxuICAgIC8qIFV0aWxpdHkgZnVuY3Rpb24gdG8gY3JlYXRlIGEgVk1MIHRhZyAqL1xuICAgIGZ1bmN0aW9uIHZtbCh0YWcsIGF0dHIpIHtcbiAgICAgIHJldHVybiBjcmVhdGVFbCgnPCcgKyB0YWcgKyAnIHhtbG5zPVwidXJuOnNjaGVtYXMtbWljcm9zb2Z0LmNvbTp2bWxcIiBjbGFzcz1cInNwaW4tdm1sXCI+JywgYXR0cik7XG4gICAgfVxuXG4gICAgLy8gTm8gQ1NTIHRyYW5zZm9ybXMgYnV0IFZNTCBzdXBwb3J0LCBhZGQgYSBDU1MgcnVsZSBmb3IgVk1MIGVsZW1lbnRzOlxuICAgIHNoZWV0LmFkZFJ1bGUoJy5zcGluLXZtbCcsICdiZWhhdmlvcjp1cmwoI2RlZmF1bHQjVk1MKScpO1xuXG4gICAgU3Bpbm5lci5wcm90b3R5cGUubGluZXMgPSBmdW5jdGlvbiAoZWwsIG8pIHtcbiAgICAgIHZhciByID0gby5zY2FsZSAqIChvLmxlbmd0aCArIG8ud2lkdGgpLFxuICAgICAgICAgIHMgPSBvLnNjYWxlICogMiAqIHI7XG5cbiAgICAgIGZ1bmN0aW9uIGdycCgpIHtcbiAgICAgICAgcmV0dXJuIGNzcyh2bWwoJ2dyb3VwJywge1xuICAgICAgICAgIGNvb3Jkc2l6ZTogcyArICcgJyArIHMsXG4gICAgICAgICAgY29vcmRvcmlnaW46IC1yICsgJyAnICsgLXJcbiAgICAgICAgfSksIHsgd2lkdGg6IHMsIGhlaWdodDogcyB9KTtcbiAgICAgIH1cblxuICAgICAgdmFyIG1hcmdpbiA9IC0oby53aWR0aCArIG8ubGVuZ3RoKSAqIG8uc2NhbGUgKiAyICsgJ3B4JyxcbiAgICAgICAgICBnID0gY3NzKGdycCgpLCB7IHBvc2l0aW9uOiAnYWJzb2x1dGUnLCB0b3A6IG1hcmdpbiwgbGVmdDogbWFyZ2luIH0pLFxuICAgICAgICAgIGk7XG5cbiAgICAgIGZ1bmN0aW9uIHNlZyhpLCBkeCwgZmlsdGVyKSB7XG4gICAgICAgIGlucyhnLCBpbnMoY3NzKGdycCgpLCB7IHJvdGF0aW9uOiAzNjAgLyBvLmxpbmVzICogaSArICdkZWcnLCBsZWZ0OiB+fmR4IH0pLCBpbnMoY3NzKHZtbCgncm91bmRyZWN0JywgeyBhcmNzaXplOiBvLmNvcm5lcnMgfSksIHsgd2lkdGg6IHIsXG4gICAgICAgICAgaGVpZ2h0OiBvLnNjYWxlICogby53aWR0aCxcbiAgICAgICAgICBsZWZ0OiBvLnNjYWxlICogby5yYWRpdXMsXG4gICAgICAgICAgdG9wOiAtby5zY2FsZSAqIG8ud2lkdGggPj4gMSxcbiAgICAgICAgICBmaWx0ZXI6IGZpbHRlclxuICAgICAgICB9KSwgdm1sKCdmaWxsJywgeyBjb2xvcjogZ2V0Q29sb3Ioby5jb2xvciwgaSksIG9wYWNpdHk6IG8ub3BhY2l0eSB9KSwgdm1sKCdzdHJva2UnLCB7IG9wYWNpdHk6IDAgfSkgLy8gdHJhbnNwYXJlbnQgc3Ryb2tlIHRvIGZpeCBjb2xvciBibGVlZGluZyB1cG9uIG9wYWNpdHkgY2hhbmdlXG4gICAgICAgICkpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG8uc2hhZG93KSBmb3IgKGkgPSAxOyBpIDw9IG8ubGluZXM7IGkrKykge1xuICAgICAgICBzZWcoaSwgLTIsICdwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuQmx1cihwaXhlbHJhZGl1cz0yLG1ha2VzaGFkb3c9MSxzaGFkb3dvcGFjaXR5PS4zKScpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGkgPSAxOyBpIDw9IG8ubGluZXM7IGkrKykge1xuICAgICAgICBzZWcoaSk7XG4gICAgICB9cmV0dXJuIGlucyhlbCwgZyk7XG4gICAgfTtcblxuICAgIFNwaW5uZXIucHJvdG90eXBlLm9wYWNpdHkgPSBmdW5jdGlvbiAoZWwsIGksIHZhbCwgbykge1xuICAgICAgdmFyIGMgPSBlbC5maXJzdENoaWxkO1xuICAgICAgbyA9IG8uc2hhZG93ICYmIG8ubGluZXMgfHwgMDtcbiAgICAgIGlmIChjICYmIGkgKyBvIDwgYy5jaGlsZE5vZGVzLmxlbmd0aCkge1xuICAgICAgICBjID0gYy5jaGlsZE5vZGVzW2kgKyBvXTtjID0gYyAmJiBjLmZpcnN0Q2hpbGQ7YyA9IGMgJiYgYy5maXJzdENoaWxkO1xuICAgICAgICBpZiAoYykgYy5vcGFjaXR5ID0gdmFsO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJykge1xuICAgIHNoZWV0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGVsID0gY3JlYXRlRWwoJ3N0eWxlJywgeyB0eXBlOiAndGV4dC9jc3MnIH0pO1xuICAgICAgaW5zKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF0sIGVsKTtcbiAgICAgIHJldHVybiBlbC5zaGVldCB8fCBlbC5zdHlsZVNoZWV0O1xuICAgIH0oKTtcblxuICAgIHZhciBwcm9iZSA9IGNzcyhjcmVhdGVFbCgnZ3JvdXAnKSwgeyBiZWhhdmlvcjogJ3VybCgjZGVmYXVsdCNWTUwpJyB9KTtcblxuICAgIGlmICghdmVuZG9yKHByb2JlLCAndHJhbnNmb3JtJykgJiYgcHJvYmUuYWRqKSBpbml0Vk1MKCk7ZWxzZSB1c2VDc3NBbmltYXRpb25zID0gdmVuZG9yKHByb2JlLCAnYW5pbWF0aW9uJyk7XG4gIH1cblxuICByZXR1cm4gU3Bpbm5lcjtcbn0pOyJdfQ==
